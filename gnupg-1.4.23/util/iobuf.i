# 1 "iobuf.c"
# 1 "<built-in>" 1
# 1 "<built-in>" 3
# 363 "<built-in>" 3
# 1 "<command line>" 1
# 1 "<built-in>" 2
# 1 "iobuf.c" 2
# 21 "iobuf.c"
# 1 "../config.h" 1
# 22 "iobuf.c" 2
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/stdio.h" 1 3




# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/wasi/api.h" 1 3
# 29 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/wasi/api.h" 3
# 1 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/stddef.h" 1 3
# 84 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/stddef.h" 3
# 1 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/__stddef_header_macro.h" 1 3
# 85 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/stddef.h" 2 3



# 1 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/__stddef_ptrdiff_t.h" 1 3
# 18 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/__stddef_ptrdiff_t.h" 3
typedef long int ptrdiff_t;
# 89 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/stddef.h" 2 3




# 1 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/__stddef_size_t.h" 1 3
# 18 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/__stddef_size_t.h" 3
typedef long unsigned int size_t;
# 94 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/stddef.h" 2 3
# 103 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/stddef.h" 3
# 1 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/__stddef_wchar_t.h" 1 3
# 24 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/__stddef_wchar_t.h" 3
typedef int wchar_t;
# 104 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/stddef.h" 2 3




# 1 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/__stddef_null.h" 1 3
# 109 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/stddef.h" 2 3
# 123 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/stddef.h" 3
# 1 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/__stddef_max_align_t.h" 1 3
# 19 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/__stddef_max_align_t.h" 3
typedef struct {
  long long __clang_max_align_nonce1
      __attribute__((__aligned__(__alignof__(long long))));
  long double __clang_max_align_nonce2
      __attribute__((__aligned__(__alignof__(long double))));
} max_align_t;
# 124 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/stddef.h" 2 3




# 1 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/__stddef_offsetof.h" 1 3
# 129 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/stddef.h" 2 3
# 30 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/wasi/api.h" 2 3
# 1 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/stdint.h" 1 3
# 56 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/stdint.h" 3
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/stdint.h" 1 3
# 20 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/stdint.h" 3
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 1 3
# 146 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 3
typedef unsigned long int uintptr_t;
# 161 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 3
typedef long int intptr_t;
# 177 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 3
typedef signed char int8_t;




typedef short int16_t;




typedef int int32_t;




typedef long long int int64_t;




typedef long long int intmax_t;




typedef unsigned char uint8_t;




typedef unsigned short uint16_t;




typedef unsigned int uint32_t;




typedef unsigned long long int uint64_t;
# 227 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 3
typedef unsigned long long int uintmax_t;
# 21 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/stdint.h" 2 3

typedef int8_t int_fast8_t;
typedef int64_t int_fast64_t;

typedef int8_t int_least8_t;
typedef int16_t int_least16_t;
typedef int32_t int_least32_t;
typedef int64_t int_least64_t;

typedef uint8_t uint_fast8_t;
typedef uint64_t uint_fast64_t;

typedef uint8_t uint_least8_t;
typedef uint16_t uint_least16_t;
typedef uint32_t uint_least32_t;
typedef uint64_t uint_least64_t;
# 95 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/stdint.h" 3
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/stdint.h" 1 3
typedef int32_t int_fast16_t;
typedef int32_t int_fast32_t;
typedef uint32_t uint_fast16_t;
typedef uint32_t uint_fast32_t;
# 96 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/stdint.h" 2 3
# 57 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/stdint.h" 2 3
# 31 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/wasi/api.h" 2 3





                                                             ;
                                                              ;
                                                              ;
                                                               ;
                                                              ;
                                                               ;
                                                              ;
                                                               ;
                                                            ;







typedef long unsigned int __wasi_size_t;

                                                                  ;
                                                                     ;




typedef uint64_t __wasi_filesize_t;

                                                                      ;
                                                                         ;




typedef uint64_t __wasi_timestamp_t;

                                                                       ;
                                                                          ;




typedef uint32_t __wasi_clockid_t;
# 102 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/wasi/api.h" 3
                                                                     ;
                                                                        ;







typedef uint16_t __wasi_errno_t;
# 498 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/wasi/api.h" 3
                                                                   ;
                                                                      ;




typedef uint64_t __wasi_rights_t;
# 663 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/wasi/api.h" 3
                                                                    ;
                                                                       ;




typedef uint32_t __wasi_fd_t;

                                                                ;
                                                                   ;




typedef struct __wasi_iovec_t {



    uint8_t * buf;




    __wasi_size_t buf_len;

} __wasi_iovec_t;

                                                                   ;
                                                                      ;
                                                                            ;
                                                                                ;




typedef struct __wasi_ciovec_t {



    const uint8_t * buf;




    __wasi_size_t buf_len;

} __wasi_ciovec_t;

                                                                    ;
                                                                       ;
                                                                             ;
                                                                                 ;




typedef int64_t __wasi_filedelta_t;

                                                                       ;
                                                                          ;




typedef uint8_t __wasi_whence_t;
# 744 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/wasi/api.h" 3
                                                                    ;
                                                                       ;






typedef uint64_t __wasi_dircookie_t;

                                                                       ;
                                                                          ;




typedef uint32_t __wasi_dirnamlen_t;

                                                                       ;
                                                                          ;




typedef uint64_t __wasi_inode_t;

                                                                   ;
                                                                      ;




typedef uint8_t __wasi_filetype_t;
# 818 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/wasi/api.h" 3
                                                                      ;
                                                                         ;




typedef struct __wasi_dirent_t {



    __wasi_dircookie_t d_next;




    __wasi_inode_t d_ino;




    __wasi_dirnamlen_t d_namlen;




    __wasi_filetype_t d_type;

} __wasi_dirent_t;

                                                                     ;
                                                                       ;
                                                                                ;
                                                                               ;
                                                                                   ;
                                                                                 ;




typedef uint8_t __wasi_advice_t;
# 889 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/wasi/api.h" 3
                                                                    ;
                                                                       ;




typedef uint16_t __wasi_fdflags_t;
# 924 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/wasi/api.h" 3
                                                                     ;
                                                                        ;




typedef struct __wasi_fdstat_t {



    __wasi_filetype_t fs_filetype;




    __wasi_fdflags_t fs_flags;




    __wasi_rights_t fs_rights_base;





    __wasi_rights_t fs_rights_inheriting;

} __wasi_fdstat_t;

                                                                     ;
                                                                       ;
                                                                                     ;
                                                                                  ;
                                                                                        ;
                                                                                               ;





typedef uint64_t __wasi_device_t;

                                                                    ;
                                                                       ;




typedef uint16_t __wasi_fstflags_t;
# 995 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/wasi/api.h" 3
                                                                      ;
                                                                         ;




typedef uint32_t __wasi_lookupflags_t;






                                                                         ;
                                                                            ;




typedef uint16_t __wasi_oflags_t;
# 1036 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/wasi/api.h" 3
                                                                    ;
                                                                       ;




typedef uint64_t __wasi_linkcount_t;

                                                                       ;
                                                                          ;




typedef struct __wasi_filestat_t {



    __wasi_device_t dev;




    __wasi_inode_t ino;




    __wasi_filetype_t filetype;




    __wasi_linkcount_t nlink;




    __wasi_filesize_t size;




    __wasi_timestamp_t atim;




    __wasi_timestamp_t mtim;




    __wasi_timestamp_t ctim;

} __wasi_filestat_t;

                                                                       ;
                                                                         ;
                                                                               ;
                                                                               ;
                                                                                     ;
                                                                                  ;
                                                                                 ;
                                                                                 ;
                                                                                 ;
                                                                                 ;





typedef uint64_t __wasi_userdata_t;

                                                                      ;
                                                                         ;




typedef uint8_t __wasi_eventtype_t;
# 1136 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/wasi/api.h" 3
                                                                       ;
                                                                          ;





typedef uint16_t __wasi_eventrwflags_t;






                                                                          ;
                                                                             ;





typedef struct __wasi_event_fd_readwrite_t {



    __wasi_filesize_t nbytes;




    __wasi_eventrwflags_t flags;

} __wasi_event_fd_readwrite_t;

                                                                                 ;
                                                                                   ;
                                                                                            ;
                                                                                           ;




typedef union __wasi_event_u_t {



    __wasi_event_fd_readwrite_t fd_readwrite;

} __wasi_event_u_t;

                                                                      ;
                                                                        ;




typedef struct __wasi_event_t {



    __wasi_userdata_t userdata;




    __wasi_errno_t error;




    __wasi_eventtype_t type;




    __wasi_event_u_t u;

} __wasi_event_t;

                                                                    ;
                                                                      ;
                                                                                 ;
                                                                              ;
                                                                              ;
                                                                           ;





typedef uint16_t __wasi_subclockflags_t;
# 1237 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/wasi/api.h" 3
                                                                           ;
                                                                              ;




typedef struct __wasi_subscription_clock_t {



    __wasi_clockid_t id;




    __wasi_timestamp_t timeout;





    __wasi_timestamp_t precision;




    __wasi_subclockflags_t flags;

} __wasi_subscription_clock_t;

                                                                                 ;
                                                                                   ;
                                                                                        ;
                                                                                             ;
                                                                                                ;
                                                                                            ;





typedef struct __wasi_subscription_fd_readwrite_t {



    __wasi_fd_t file_descriptor;

} __wasi_subscription_fd_readwrite_t;

                                                                                       ;
                                                                                          ;
                                                                                                            ;




typedef union __wasi_subscription_u_t {



    __wasi_subscription_clock_t clock;




    __wasi_subscription_fd_readwrite_t fd_readwrite;

} __wasi_subscription_u_t;

                                                                             ;
                                                                               ;




typedef struct __wasi_subscription_t {




    __wasi_userdata_t userdata;




    __wasi_eventtype_t type;




    __wasi_subscription_u_t u;

} __wasi_subscription_t;

                                                                           ;
                                                                             ;
                                                                                        ;
                                                                                    ;
                                                                                  ;




typedef uint32_t __wasi_exitcode_t;

                                                                      ;
                                                                         ;




typedef uint8_t __wasi_signal_t;
# 1536 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/wasi/api.h" 3
                                                                    ;
                                                                       ;




typedef uint16_t __wasi_riflags_t;
# 1554 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/wasi/api.h" 3
                                                                     ;
                                                                        ;




typedef uint16_t __wasi_roflags_t;






                                                                     ;
                                                                        ;





typedef uint16_t __wasi_siflags_t;

                                                                     ;
                                                                        ;




typedef uint8_t __wasi_sdflags_t;
# 1594 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/wasi/api.h" 3
                                                                     ;
                                                                        ;




typedef uint8_t __wasi_preopentype_t;






                                                                         ;
                                                                            ;




typedef struct __wasi_prestat_dir_t {



    __wasi_size_t pr_name_len;

} __wasi_prestat_dir_t;

                                                                         ;
                                                                            ;
                                                                                          ;




typedef union __wasi_prestat_u_t {



    __wasi_prestat_dir_t dir;

} __wasi_prestat_u_t;

                                                                       ;
                                                                          ;




typedef struct __wasi_prestat_t {



    __wasi_preopentype_t pr_type;




    __wasi_prestat_u_t u;

} __wasi_prestat_t;

                                                                     ;
                                                                        ;
                                                                                  ;
                                                                            ;
# 1669 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/wasi/api.h" 3
__wasi_errno_t __wasi_args_get(
    uint8_t * * argv,

    uint8_t * argv_buf
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("args_get"),
    __warn_unused_result__
));




__wasi_errno_t __wasi_args_sizes_get(



    __wasi_size_t *argc,



    __wasi_size_t *argv_buf_size
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("args_sizes_get"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_environ_get(
    uint8_t * * environ,

    uint8_t * environ_buf
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("environ_get"),
    __warn_unused_result__
));




__wasi_errno_t __wasi_environ_sizes_get(



    __wasi_size_t *argc,



    __wasi_size_t *argv_buf_size
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("environ_sizes_get"),
    __warn_unused_result__
));







__wasi_errno_t __wasi_clock_res_get(



    __wasi_clockid_t id,




    __wasi_timestamp_t *resolution
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("clock_res_get"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_clock_time_get(



    __wasi_clockid_t id,




    __wasi_timestamp_t precision,




    __wasi_timestamp_t *time
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("clock_time_get"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_fd_advise(
    __wasi_fd_t fd,




    __wasi_filesize_t offset,




    __wasi_filesize_t len,




    __wasi_advice_t advice
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("fd_advise"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_fd_allocate(
    __wasi_fd_t fd,




    __wasi_filesize_t offset,




    __wasi_filesize_t len
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("fd_allocate"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_fd_close(
    __wasi_fd_t fd
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("fd_close"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_fd_datasync(
    __wasi_fd_t fd
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("fd_datasync"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_fd_fdstat_get(
    __wasi_fd_t fd,




    __wasi_fdstat_t *stat
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("fd_fdstat_get"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_fd_fdstat_set_flags(
    __wasi_fd_t fd,




    __wasi_fdflags_t flags
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("fd_fdstat_set_flags"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_fd_fdstat_set_rights(
    __wasi_fd_t fd,




    __wasi_rights_t fs_rights_base,

    __wasi_rights_t fs_rights_inheriting
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("fd_fdstat_set_rights"),
    __warn_unused_result__
));




__wasi_errno_t __wasi_fd_filestat_get(
    __wasi_fd_t fd,




    __wasi_filestat_t *buf
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("fd_filestat_get"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_fd_filestat_set_size(
    __wasi_fd_t fd,




    __wasi_filesize_t size
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("fd_filestat_set_size"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_fd_filestat_set_times(
    __wasi_fd_t fd,




    __wasi_timestamp_t atim,




    __wasi_timestamp_t mtim,




    __wasi_fstflags_t fst_flags
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("fd_filestat_set_times"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_fd_pread(
    __wasi_fd_t fd,




    const __wasi_iovec_t *iovs,




    size_t iovs_len,




    __wasi_filesize_t offset,




    __wasi_size_t *nread
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("fd_pread"),
    __warn_unused_result__
));




__wasi_errno_t __wasi_fd_prestat_get(
    __wasi_fd_t fd,




    __wasi_prestat_t *buf
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("fd_prestat_get"),
    __warn_unused_result__
));




__wasi_errno_t __wasi_fd_prestat_dir_name(
    __wasi_fd_t fd,




    uint8_t * path,

    __wasi_size_t path_len
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("fd_prestat_dir_name"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_fd_pwrite(
    __wasi_fd_t fd,




    const __wasi_ciovec_t *iovs,




    size_t iovs_len,




    __wasi_filesize_t offset,




    __wasi_size_t *nwritten
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("fd_pwrite"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_fd_read(
    __wasi_fd_t fd,




    const __wasi_iovec_t *iovs,




    size_t iovs_len,




    __wasi_size_t *nread
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("fd_read"),
    __warn_unused_result__
));
# 2098 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/wasi/api.h" 3
__wasi_errno_t __wasi_fd_readdir(
    __wasi_fd_t fd,




    uint8_t * buf,

    __wasi_size_t buf_len,




    __wasi_dircookie_t cookie,




    __wasi_size_t *bufused
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("fd_readdir"),
    __warn_unused_result__
));
# 2133 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/wasi/api.h" 3
__wasi_errno_t __wasi_fd_renumber(
    __wasi_fd_t fd,




    __wasi_fd_t to
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("fd_renumber"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_fd_seek(
    __wasi_fd_t fd,




    __wasi_filedelta_t offset,




    __wasi_whence_t whence,




    __wasi_filesize_t *newoffset
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("fd_seek"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_fd_sync(
    __wasi_fd_t fd
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("fd_sync"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_fd_tell(
    __wasi_fd_t fd,




    __wasi_filesize_t *offset
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("fd_tell"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_fd_write(
    __wasi_fd_t fd,




    const __wasi_ciovec_t *iovs,




    size_t iovs_len,




    __wasi_size_t *nwritten
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("fd_write"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_path_create_directory(
    __wasi_fd_t fd,




    const char *path,




    size_t path_len
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("path_create_directory"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_path_filestat_get(
    __wasi_fd_t fd,




    __wasi_lookupflags_t flags,




    const char *path,




    size_t path_len,




    __wasi_filestat_t *buf
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("path_filestat_get"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_path_filestat_set_times(
    __wasi_fd_t fd,




    __wasi_lookupflags_t flags,




    const char *path,




    size_t path_len,




    __wasi_timestamp_t atim,




    __wasi_timestamp_t mtim,




    __wasi_fstflags_t fst_flags
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("path_filestat_set_times"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_path_link(
    __wasi_fd_t old_fd,




    __wasi_lookupflags_t old_flags,




    const char *old_path,




    size_t old_path_len,




    __wasi_fd_t new_fd,




    const char *new_path,




    size_t new_path_len
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("path_link"),
    __warn_unused_result__
));
# 2376 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/wasi/api.h" 3
__wasi_errno_t __wasi_path_open(
    __wasi_fd_t fd,




    __wasi_lookupflags_t dirflags,





    const char *path,




    size_t path_len,




    __wasi_oflags_t oflags,
# 2409 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/wasi/api.h" 3
    __wasi_rights_t fs_rights_base,

    __wasi_rights_t fs_rights_inherting,

    __wasi_fdflags_t fdflags,




    __wasi_fd_t *opened_fd
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("path_open"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_path_readlink(
    __wasi_fd_t fd,




    const char *path,




    size_t path_len,




    uint8_t * buf,

    __wasi_size_t buf_len,




    __wasi_size_t *bufused
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("path_readlink"),
    __warn_unused_result__
));






__wasi_errno_t __wasi_path_remove_directory(
    __wasi_fd_t fd,




    const char *path,




    size_t path_len
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("path_remove_directory"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_path_rename(
    __wasi_fd_t fd,




    const char *old_path,




    size_t old_path_len,




    __wasi_fd_t new_fd,




    const char *new_path,




    size_t new_path_len
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("path_rename"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_path_symlink(



    const char *old_path,




    size_t old_path_len,

    __wasi_fd_t fd,




    const char *new_path,




    size_t new_path_len
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("path_symlink"),
    __warn_unused_result__
));






__wasi_errno_t __wasi_path_unlink_file(
    __wasi_fd_t fd,




    const char *path,




    size_t path_len
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("path_unlink_file"),
    __warn_unused_result__
));




__wasi_errno_t __wasi_poll_oneoff(



    const __wasi_subscription_t * in,




    __wasi_event_t * out,




    __wasi_size_t nsubscriptions,




    __wasi_size_t *nevents
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("poll_oneoff"),
    __warn_unused_result__
));






_Noreturn void __wasi_proc_exit(



    __wasi_exitcode_t rval
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("proc_exit")));





__wasi_errno_t __wasi_proc_raise(



    __wasi_signal_t sig
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("proc_raise"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_sched_yield(
    void
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("sched_yield"),
    __warn_unused_result__
));
# 2652 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/wasi/api.h" 3
__wasi_errno_t __wasi_random_get(



    uint8_t * buf,

    __wasi_size_t buf_len
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("random_get"),
    __warn_unused_result__
));






__wasi_errno_t __wasi_sock_recv(
    __wasi_fd_t fd,




    const __wasi_iovec_t *ri_data,




    size_t ri_data_len,




    __wasi_riflags_t ri_flags,




    __wasi_size_t *ro_datalen,



    __wasi_roflags_t *ro_flags
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("sock_recv"),
    __warn_unused_result__
));






__wasi_errno_t __wasi_sock_send(
    __wasi_fd_t fd,




    const __wasi_ciovec_t *si_data,




    size_t si_data_len,




    __wasi_siflags_t si_flags,




    __wasi_size_t *so_datalen
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("sock_send"),
    __warn_unused_result__
));





__wasi_errno_t __wasi_sock_shutdown(
    __wasi_fd_t fd,




    __wasi_sdflags_t how
) __attribute__((
    __import_module__("wasi_snapshot_preview1"),
    __import_name__("sock_shutdown"),
    __warn_unused_result__
));
# 6 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/stdio.h" 2 3






# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/features.h" 1 3
# 13 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/stdio.h" 2 3
# 30 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/stdio.h" 3
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 1 3
# 15 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 3
typedef __builtin_va_list va_list;




typedef __builtin_va_list __isoc_va_list;
# 141 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 3
typedef unsigned long int size_t;
# 156 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 3
typedef long int ssize_t;
# 243 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 3
typedef long long int off_t;
# 400 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 3
typedef struct _IO_FILE FILE;
# 31 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/stdio.h" 2 3
# 66 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/stdio.h" 3
typedef union _G_fpos64_t {
 char __opaque[16];
 long long __lldata;
 double __align;
} fpos_t;

extern FILE *const stdin;
extern FILE *const stdout;
extern FILE *const stderr;





FILE *fopen(const char *restrict, const char *restrict);
FILE *freopen(const char *restrict, const char *restrict, FILE *restrict);
int fclose(FILE *);

int remove(const char *);
int rename(const char *, const char *);

int feof(FILE *);
int ferror(FILE *);
int fflush(FILE *);
void clearerr(FILE *);

int fseek(FILE *, long, int);
long ftell(FILE *);
void rewind(FILE *);

int fgetpos(FILE *restrict, fpos_t *restrict);
int fsetpos(FILE *, const fpos_t *);

size_t fread(void *restrict, size_t, size_t, FILE *restrict);
size_t fwrite(const void *restrict, size_t, size_t, FILE *restrict);

int fgetc(FILE *);
int getc(FILE *);
int getchar(void);
int ungetc(int, FILE *);

int fputc(int, FILE *);
int putc(int, FILE *);
int putchar(int);

char *fgets(char *restrict, int, FILE *restrict);




int fputs(const char *restrict, FILE *restrict);
int puts(const char *);

int printf(const char *restrict, ...);
int fprintf(FILE *restrict, const char *restrict, ...);
int sprintf(char *restrict, const char *restrict, ...);
int snprintf(char *restrict, size_t, const char *restrict, ...);

int vprintf(const char *restrict, __isoc_va_list);
int vfprintf(FILE *restrict, const char *restrict, __isoc_va_list);
int vsprintf(char *restrict, const char *restrict, __isoc_va_list);
int vsnprintf(char *restrict, size_t, const char *restrict, __isoc_va_list);

int scanf(const char *restrict, ...);
int fscanf(FILE *restrict, const char *restrict, ...);
int sscanf(const char *restrict, const char *restrict, ...);
int vscanf(const char *restrict, __isoc_va_list);
int vfscanf(FILE *restrict, const char *restrict, __isoc_va_list);
int vsscanf(const char *restrict, const char *restrict, __isoc_va_list);

void perror(const char *);

int setvbuf(FILE *restrict, char *restrict, int, size_t);
void setbuf(FILE *restrict, char *restrict);

char *tmpnam(char *);
FILE *tmpfile(void);




FILE *fmemopen(void *restrict, size_t, const char *restrict);
FILE *open_memstream(char **, size_t *);
FILE *fdopen(int, const char *);
FILE *popen(const char *, const char *);
int pclose(FILE *);
int fileno(FILE *);
int fseeko(FILE *, off_t, int);
off_t ftello(FILE *);
int dprintf(int, const char *restrict, ...);
int vdprintf(int, const char *restrict, __isoc_va_list);
void flockfile(FILE *);
int ftrylockfile(FILE *);
void funlockfile(FILE *);
int getc_unlocked(FILE *);
int getchar_unlocked(void);
int putc_unlocked(int, FILE *);
int putchar_unlocked(int);
ssize_t getdelim(char **restrict, size_t *restrict, int, FILE *restrict);
ssize_t getline(char **restrict, size_t *restrict, FILE *restrict);
int renameat(int, const char *, int, const char *);
char *ctermid(char *);







char *tempnam(const char *, const char *);




char *cuserid(char *);
void setlinebuf(FILE *);
void setbuffer(FILE *, char *, size_t);
int fgetc_unlocked(FILE *);
int fputc_unlocked(int, FILE *);
int fflush_unlocked(FILE *);
size_t fread_unlocked(void *, size_t, size_t, FILE *);
size_t fwrite_unlocked(const void *, size_t, size_t, FILE *);
void clearerr_unlocked(FILE *);
int feof_unlocked(FILE *);
int ferror_unlocked(FILE *);
int fileno_unlocked(FILE *);
int getw(FILE *);
int putw(int, FILE *);
char *fgetln(FILE *, size_t *);
int asprintf(char **, const char *, ...);
int vasprintf(char **, const char *, __isoc_va_list);



char *fgets_unlocked(char *, int, FILE *);
int fputs_unlocked(const char *, FILE *);

typedef ssize_t (cookie_read_function_t)(void *, char *, size_t);
typedef ssize_t (cookie_write_function_t)(void *, const char *, size_t);
typedef int (cookie_seek_function_t)(void *, off_t *, int);
typedef int (cookie_close_function_t)(void *);

typedef struct _IO_cookie_io_functions_t {
 cookie_read_function_t *read;
 cookie_write_function_t *write;
 cookie_seek_function_t *seek;
 cookie_close_function_t *close;
} cookie_io_functions_t;

FILE *fopencookie(void *, const char *, cookie_io_functions_t);
# 23 "iobuf.c" 2
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/compat/stdlib.h" 1 3







int getloadavg(double loadavg[], int nelem);





# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/stdlib.h" 1 3
# 21 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/stdlib.h" 3
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 1 3
# 40 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 3
typedef int wchar_t;
# 22 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/stdlib.h" 2 3

int atoi (const char *);
long atol (const char *);
long long atoll (const char *);
double atof (const char *);

float strtof (const char *restrict, char **restrict);
double strtod (const char *restrict, char **restrict);
long double strtold (const char *restrict, char **restrict);

long strtol (const char *restrict, char **restrict, int);
unsigned long strtoul (const char *restrict, char **restrict, int);
long long strtoll (const char *restrict, char **restrict, int);
unsigned long long strtoull (const char *restrict, char **restrict, int);

int rand (void);
void srand (unsigned);

void *malloc (size_t);
void *calloc (size_t, size_t);
void *realloc (void *, size_t);
void free (void *);
void *aligned_alloc(size_t, size_t);

_Noreturn void abort (void);
int atexit (void (*) (void));
_Noreturn void exit (int);
_Noreturn void _Exit (int);
int at_quick_exit (void (*) (void));
_Noreturn void quick_exit (int);

char *getenv (const char *);

int system (const char *);

void *bsearch (const void *, const void *, size_t, size_t, int (*)(const void *, const void *));
void qsort (void *, size_t, size_t, int (*)(const void *, const void *));

int abs (int);
long labs (long);
long long llabs (long long);

typedef struct { int quot, rem; } div_t;
typedef struct { long quot, rem; } ldiv_t;
typedef struct { long long quot, rem; } lldiv_t;

div_t div (int, int);
ldiv_t ldiv (long, long);
lldiv_t lldiv (long long, long long);

int mblen (const char *, size_t);
int mbtowc (wchar_t *restrict, const char *restrict, size_t);
int wctomb (char *, wchar_t);
size_t mbstowcs (wchar_t *restrict, const char *restrict, size_t);
size_t wcstombs (char *restrict, const wchar_t *restrict, size_t);




size_t __ctype_get_mb_cur_max(void);
# 101 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/stdlib.h" 3
int posix_memalign (void **, size_t, size_t);
int setenv (const char *, const char *, int);
int unsetenv (const char *);
int mkstemp (char *);
int mkostemp (char *, int);
char *mkdtemp (char *);
int getsubopt (char **, char *const *, char **);
int rand_r (unsigned *);






char *realpath (const char *restrict, char *restrict);
long int random (void);
void srandom (unsigned int);
char *initstate (unsigned int, char *, size_t);
char *setstate (char *);
int putenv (char *);
int posix_openpt (int);
int grantpt (int);
int unlockpt (int);
char *ptsname (int);
char *l64a (long);
long a64l (const char *);
void setkey (const char *);
double drand48 (void);
double erand48 (unsigned short [3]);
long int lrand48 (void);
long int nrand48 (unsigned short [3]);
long mrand48 (void);
long jrand48 (unsigned short [3]);
void srand48 (long);
unsigned short *seed48 (unsigned short [3]);
void lcong48 (unsigned short [7]);



# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/alloca.h" 1 3








# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 1 3
# 10 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/alloca.h" 2 3

void *alloca(size_t);
# 141 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/stdlib.h" 2 3
char *mktemp (char *);
int mkstemps (char *, int);
int mkostemps (char *, int, int);
void *valloc (size_t);
void *memalign(size_t, size_t);
int getloadavg(double *, int);
int clearenv(void);


void *reallocarray (void *, size_t, size_t);
void qsort_r (void *, size_t, size_t, int (*)(const void *, const void *, void *), void *);



int ptsname_r(int, char *, size_t);
char *ecvt(double, int, int *, int *);
char *fcvt(double, int, int *, int *);
char *gcvt(double, int, char *);
char *secure_getenv(const char *);
struct __locale_struct;
float strtof_l(const char *restrict, char **restrict, struct __locale_struct *);
double strtod_l(const char *restrict, char **restrict, struct __locale_struct *);
long double strtold_l(const char *restrict, char **restrict, struct __locale_struct *);
# 15 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/compat/stdlib.h" 2 3
# 24 "iobuf.c" 2
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/compat/string.h" 1 3







extern char* strlwr(char *);
extern char* strupr(char *);





# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/string.h" 1 3
# 25 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/string.h" 3
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 1 3
# 412 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 3
typedef struct __locale_struct * locale_t;
# 26 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/string.h" 2 3

void *memcpy (void *restrict, const void *restrict, size_t);
void *memmove (void *, const void *, size_t);
void *memset (void *, int, size_t);
int memcmp (const void *, const void *, size_t);
void *memchr (const void *, int, size_t);

char *strcpy (char *restrict, const char *restrict);
char *strncpy (char *restrict, const char *restrict, size_t);

char *strcat (char *restrict, const char *restrict);
char *strncat (char *restrict, const char *restrict, size_t);

int strcmp (const char *, const char *);
int strncmp (const char *, const char *, size_t);

int strcoll (const char *, const char *);
size_t strxfrm (char *restrict, const char *restrict, size_t);

char *strchr (const char *, int);
char *strrchr (const char *, int);

size_t strcspn (const char *, const char *);
size_t strspn (const char *, const char *);
char *strpbrk (const char *, const char *);
char *strstr (const char *, const char *);
char *strtok (char *restrict, const char *restrict);

size_t strlen (const char *);

char *strerror (int);


# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/strings.h" 1 3
# 12 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/strings.h" 3
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 1 3
# 13 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/strings.h" 2 3




int bcmp (const void *, const void *, size_t);
void bcopy (const void *, void *, size_t);
void bzero (void *, size_t);
char *index (const char *, int);
char *rindex (const char *, int);



int ffs (int);
int ffsl (long);
int ffsll (long long);


int strcasecmp (const char *, const char *);
int strncasecmp (const char *, const char *, size_t);

int strcasecmp_l (const char *, const char *, locale_t);
int strncasecmp_l (const char *, const char *, size_t, locale_t);
# 60 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/string.h" 2 3





char *strtok_r (char *restrict, const char *restrict, char **restrict);
int strerror_r (int, char *, size_t);
char *stpcpy(char *restrict, const char *restrict);
char *stpncpy(char *restrict, const char *restrict, size_t);
size_t strnlen (const char *, size_t);
char *strdup (const char *);
char *strndup (const char *, size_t);
char *strsignal(int);
char *strerror_l (int, locale_t);
int strcoll_l (const char *, const char *, locale_t);
size_t strxfrm_l (char *restrict, const char *restrict, size_t, locale_t);
void *memmem(const void *, size_t, const void *, size_t);




void *memccpy (void *restrict, const void *restrict, int, size_t);



char *strsep(char **, const char *);
size_t strlcat (char *, const char *, size_t);
size_t strlcpy (char *, const char *, size_t);
void explicit_bzero (void *, size_t);




int strverscmp (const char *, const char *);
char *strchrnul(const char *, int);
char *strcasestr(const char *, const char *);
void *memrchr(const void *, int, size_t);
void *mempcpy(void *, const void *, size_t);
# 16 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/compat/string.h" 2 3
# 25 "iobuf.c" 2
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/errno.h" 1 3
# 10 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/errno.h" 3
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/errno.h" 1 3
# 11 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/errno.h" 2 3


__attribute__((const))

int *__errno_location(void);



extern char *program_invocation_short_name, *program_invocation_name;
# 26 "iobuf.c" 2
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/ctype.h" 1 3
# 10 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/ctype.h" 3
int isalnum(int);
int isalpha(int);
int isblank(int);
int iscntrl(int);
int isdigit(int);
int isgraph(int);
int islower(int);
int isprint(int);
int ispunct(int);
int isspace(int);
int isupper(int);
int isxdigit(int);
int tolower(int);
int toupper(int);


static inline int __isspace(int _c)
{
 return _c == ' ' || (unsigned)_c-'\t' < 5;
}
# 46 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/ctype.h" 3
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 1 3
# 47 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/ctype.h" 2 3

int isalnum_l(int, locale_t);
int isalpha_l(int, locale_t);
int isblank_l(int, locale_t);
int iscntrl_l(int, locale_t);
int isdigit_l(int, locale_t);
int isgraph_l(int, locale_t);
int islower_l(int, locale_t);
int isprint_l(int, locale_t);
int ispunct_l(int, locale_t);
int isspace_l(int, locale_t);
int isupper_l(int, locale_t);
int isxdigit_l(int, locale_t);
int tolower_l(int, locale_t);
int toupper_l(int, locale_t);

int isascii(int);
int toascii(int);
# 27 "iobuf.c" 2
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/assert.h" 1 3
# 19 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/assert.h" 3
_Noreturn void __assert_fail (const char *, const char *, int, const char *);
# 28 "iobuf.c" 2
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/sys/types.h" 1 3
# 57 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/sys/types.h" 3
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 1 3
# 83 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 3
typedef long long int time_t;




typedef int suseconds_t;





typedef struct {
    union {
        int __i[10];
        volatile int __vi[10];
        unsigned long __s[10];
    } __u;



    const char *_a_transferredcanvases;

} pthread_attr_t;




typedef struct { union { int __i[6]; volatile int __vi[6]; volatile void *__p[6]; } __u; } pthread_mutex_t;
# 120 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 3
typedef struct { union { int __i[12]; volatile int __vi[12]; void *__p[12]; } __u; } pthread_cond_t;
# 130 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 3
typedef struct { union { int __i[sizeof(long)==8?14:8]; volatile int __vi[sizeof(long)==8?14:8]; void *__p[sizeof(long)==8?7:8]; } __u; } pthread_rwlock_t;




typedef struct { union { int __i[5]; volatile int __vi[5]; void *__p[5]; } __u; } pthread_barrier_t;
# 171 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 3
typedef long int register_t;
# 222 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 3
typedef unsigned long long int u_int64_t;
# 233 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 3
typedef unsigned mode_t;




typedef unsigned long int nlink_t;
# 248 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 3
typedef unsigned long long int ino_t;




typedef unsigned int dev_t;




typedef int blksize_t;




typedef int blkcnt_t;




typedef unsigned int fsblkcnt_t;




typedef unsigned int fsfilcnt_t;
# 289 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 3
typedef void * timer_t;




typedef int clockid_t;




typedef int clock_t;
# 320 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 3
typedef int pid_t;




typedef unsigned id_t;




typedef unsigned uid_t;




typedef unsigned gid_t;




typedef int key_t;




typedef unsigned useconds_t;
# 358 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 3
typedef struct __pthread * pthread_t;





typedef int pthread_once_t;




typedef unsigned pthread_key_t;




typedef int pthread_spinlock_t;




typedef struct { unsigned __attr; } pthread_mutexattr_t;




typedef struct { unsigned __attr; } pthread_condattr_t;




typedef struct { unsigned __attr; } pthread_barrierattr_t;




typedef struct { unsigned __attr[2]; } pthread_rwlockattr_t;
# 58 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/sys/types.h" 2 3


typedef unsigned char u_int8_t;
typedef unsigned short u_int16_t;
typedef unsigned u_int32_t;
typedef char *caddr_t;
typedef unsigned char u_char;
typedef unsigned short u_short, ushort;
typedef unsigned u_int, uint;
typedef unsigned long u_long, ulong;
typedef long long quad_t;
typedef unsigned long long u_quad_t;
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/endian.h" 1 3
# 10 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/endian.h" 3
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 1 3
# 11 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/endian.h" 2 3








static inline uint16_t __bswap16(uint16_t __x)
{
 return __x<<8 | __x>>8;
}

static inline uint32_t __bswap32(uint32_t __x)
{
 return __x>>24 | __x>>8&0xff00 | __x<<8&0xff0000 | __x<<24;
}

static inline uint64_t __bswap64(uint64_t __x)
{
 return __bswap32(__x)+0ULL<<32 | __bswap32(__x>>32);
}
# 71 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/sys/types.h" 2 3
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/sys/select.h" 1 3
# 16 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/sys/select.h" 3
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 1 3
# 309 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 3
struct timeval { time_t tv_sec; suseconds_t tv_usec; };




struct timespec { time_t tv_sec; long tv_nsec; };
# 418 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 3
typedef struct __sigset_t { unsigned long __bits[128/sizeof(long)]; } sigset_t;
# 17 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/sys/select.h" 2 3



typedef unsigned long fd_mask;

typedef struct {
 unsigned long fds_bits[1024 / 8 / sizeof(long)];
} fd_set;






int select (int, fd_set *restrict, fd_set *restrict, fd_set *restrict, struct timeval *restrict);
int pselect (int, fd_set *restrict, fd_set *restrict, fd_set *restrict, const struct timespec *restrict, const sigset_t *restrict);
# 72 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/sys/types.h" 2 3
# 29 "iobuf.c" 2
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/compat/sys/stat.h" 1 3







# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/sys/stat.h" 1 3
# 28 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/sys/stat.h" 3
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 1 3
# 29 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/sys/stat.h" 2 3

# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/stat.h" 1 3



struct stat
{
 dev_t st_dev;




 mode_t st_mode;
 nlink_t st_nlink;
 uid_t st_uid;
 gid_t st_gid;
 dev_t st_rdev;



 off_t st_size;
 blksize_t st_blksize;
 blkcnt_t st_blocks;
 struct timespec st_atim;
 struct timespec st_mtim;
 struct timespec st_ctim;
 ino_t st_ino;
};
# 31 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/sys/stat.h" 2 3
# 80 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/sys/stat.h" 3
int stat(const char *restrict, struct stat *restrict);
int fstat(int, struct stat *);
int lstat(const char *restrict, struct stat *restrict);
int fstatat(int, const char *restrict, struct stat *restrict, int);
int chmod(const char *, mode_t);
int fchmod(int, mode_t);
int fchmodat(int, const char *, mode_t, int);
mode_t umask(mode_t);
int mkdir(const char *, mode_t);
int mkfifo(const char *, mode_t);
int mkdirat(int, const char *, mode_t);
int mkfifoat(int, const char *, mode_t);


int mknod(const char *, mode_t, dev_t);
int mknodat(int, const char *, mode_t, dev_t);


int futimens(int, const struct timespec [2]);
int utimensat(int, const char *, const struct timespec [2], int);


int lchmod(const char *, mode_t);
# 124 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/sys/stat.h" 3
struct statx_timestamp {
 int64_t tv_sec;
 uint32_t tv_nsec, __pad;
};

struct statx {
 uint32_t stx_mask;
 uint32_t stx_blksize;
 uint64_t stx_attributes;
 uint32_t stx_nlink;
 uint32_t stx_uid;
 uint32_t stx_gid;
 uint16_t stx_mode;
 uint16_t __pad0[1];
 uint64_t stx_ino;
 uint64_t stx_size;
 uint64_t stx_blocks;
 uint64_t stx_attributes_mask;
 struct statx_timestamp stx_atime;
 struct statx_timestamp stx_btime;
 struct statx_timestamp stx_ctime;
 struct statx_timestamp stx_mtime;
 uint32_t stx_rdev_major;
 uint32_t stx_rdev_minor;
 uint32_t stx_dev_major;
 uint32_t stx_dev_minor;
 uint64_t __pad1[14];
};

int statx(int, const char *restrict, int, unsigned, struct statx *restrict);
# 9 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/compat/sys/stat.h" 2 3
# 30 "iobuf.c" 2
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/fcntl.h" 1 3
# 24 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/fcntl.h" 3
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 1 3
# 424 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 3
struct iovec { void *iov_base; size_t iov_len; };
# 25 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/fcntl.h" 2 3

# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/fcntl.h" 1 3
# 27 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/fcntl.h" 2 3

struct flock {
 short l_type;
 short l_whence;
 off_t l_start;
 off_t l_len;
 pid_t l_pid;
};

int creat(const char *, mode_t);
int fcntl(int, int, ...);
int open(const char *, int, ...);
int openat(int, const char *, int, ...);
int posix_fadvise(int, off_t, off_t, int);
int posix_fallocate(int, off_t, off_t);
# 169 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/fcntl.h" 3
int lockf(int, int, off_t);







struct file_handle {
 unsigned handle_bytes;
 int handle_type;
 unsigned char f_handle[];
};
struct f_owner_ex {
 int type;
 pid_t pid;
};
# 196 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/fcntl.h" 3
int fallocate(int, int, off_t, off_t);
int name_to_handle_at(int, const char *, struct file_handle *, int *, int);
int open_by_handle_at(int, struct file_handle *, int);
ssize_t readahead(int, off_t, size_t);
int sync_file_range(int, off_t, off_t, unsigned);
ssize_t vmsplice(int, const struct iovec *, size_t, unsigned);
ssize_t splice(int, off_t *, int, off_t *, size_t, unsigned);
ssize_t tee(int, int, size_t, unsigned);
# 31 "iobuf.c" 2
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/unistd.h" 1 3
# 47 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/unistd.h" 3
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 1 3
# 48 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/unistd.h" 2 3

int pipe(int [2]);
int pipe2(int [2], int);
int close(int);
int posix_close(int, int);
int dup(int);
int dup2(int, int);
int dup3(int, int, int);
off_t lseek(int, off_t, int);
int fsync(int);
int fdatasync(int);

ssize_t read(int, void *, size_t);
ssize_t write(int, const void *, size_t);
ssize_t pread(int, void *, size_t, off_t);
ssize_t pwrite(int, const void *, size_t, off_t);

int chown(const char *, uid_t, gid_t);
int fchown(int, uid_t, gid_t);
int lchown(const char *, uid_t, gid_t);
int fchownat(int, const char *, uid_t, gid_t, int);

int link(const char *, const char *);
int linkat(int, const char *, int, const char *, int);
int symlink(const char *, const char *);
int symlinkat(const char *, int, const char *);
ssize_t readlink(const char *restrict, char *restrict, size_t);
ssize_t readlinkat(int, const char *restrict, char *restrict, size_t);
int unlink(const char *);
int unlinkat(int, const char *, int);
int rmdir(const char *);
int truncate(const char *, off_t);
int ftruncate(int, off_t);






int access(const char *, int);
int faccessat(int, const char *, int, int);

int chdir(const char *);
int fchdir(int);
char *getcwd(char *, size_t);

unsigned alarm(unsigned);
unsigned sleep(unsigned);
int pause(void);

pid_t fork(void);
pid_t _Fork(void);
int execve(const char *, char *const [], char *const []);
int execv(const char *, char *const []);
int execle(const char *, const char *, ...);
int execl(const char *, const char *, ...);
int execvp(const char *, char *const []);
int execlp(const char *, const char *, ...);
int fexecve(int, char *const [], char *const []);
_Noreturn void _exit(int);

pid_t getpid(void);
pid_t getppid(void);
pid_t getpgrp(void);
pid_t getpgid(pid_t);
int setpgid(pid_t, pid_t);
pid_t setsid(void);
pid_t getsid(pid_t);
char *ttyname(int);
int ttyname_r(int, char *, size_t);
int isatty(int);
pid_t tcgetpgrp(int);
int tcsetpgrp(int, pid_t);

uid_t getuid(void);
uid_t geteuid(void);
gid_t getgid(void);
gid_t getegid(void);
int getgroups(int, gid_t []);
int setuid(uid_t);
int seteuid(uid_t);
int setgid(gid_t);
int setegid(gid_t);

char *getlogin(void);
int getlogin_r(char *, size_t);
int gethostname(char *, size_t);
char *ctermid(char *);

int getopt(int, char * const [], const char *);
extern char *optarg;
extern int optind, opterr, optopt;

long pathconf(const char *, int);
long fpathconf(int, int);
long sysconf(int);
size_t confstr(int, char *, size_t);






int setreuid(uid_t, uid_t);
int setregid(gid_t, gid_t);
int lockf(int, int, off_t);
long gethostid(void);
int nice(int);
void sync(void);
pid_t setpgrp(void);
char *crypt(const char *, const char *);
void encrypt(char *, int);
void swab(const void *restrict, void *restrict, ssize_t);




int usleep(unsigned);
unsigned ualarm(unsigned, unsigned);






int brk(void *);
void *sbrk(intptr_t);
pid_t vfork(void);
int vhangup(void);
int chroot(const char *);
int getpagesize(void);
int getdtablesize(void);
int sethostname(const char *, size_t);
int getdomainname(char *, size_t);
int setdomainname(const char *, size_t);
int setgroups(size_t, const gid_t *);
char *getpass(const char *);
int daemon(int, int);
void setusershell(void);
void endusershell(void);
char *getusershell(void);
int acct(const char *);

int execvpe(const char *, char *const [], char *const []);
int issetugid(void);
int getentropy(void *, size_t);
extern int optreset;



extern char **environ;
int setresuid(uid_t, uid_t, uid_t);
int setresgid(gid_t, gid_t, gid_t);
int getresuid(uid_t *, uid_t *, uid_t *);
int getresgid(gid_t *, gid_t *, gid_t *);
char *get_current_dir_name(void);
int syncfs(int);
int euidaccess(const char *, int);
int eaccess(const char *, int);
ssize_t copy_file_range(int, off_t *, int, off_t *, size_t, unsigned);
pid_t gettid(void);
# 292 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/unistd.h" 3
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/posix.h" 1 3
# 293 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/unistd.h" 2 3
# 32 "iobuf.c" 2








# 1 "../include/memory.h" 1
# 57 "../include/memory.h"
void *xmalloc( size_t n );
void *xtrymalloc (size_t n);
void *xmalloc_clear( size_t n );
void *xmalloc_secure( size_t n );
void *xmalloc_secure_clear( size_t n );
void *xrealloc( void *a, size_t n );
void xfree( void *p );
void m_check( const void *a );

char *xstrdup( const char * a);
char *xtrystrdup (const char *a);


size_t m_size( const void *a );
void m_print_stats(const char *prefix);


void *xcalloc (size_t n, size_t m);
void *xcalloc_secure (size_t n, size_t m);



int secmem_init( size_t npool );
void secmem_term( void );
void *secmem_malloc( size_t size );
void *secmexrealloc( void *a, size_t newsize );
void secmem_free( void *a );
int m_is_secure( const void *p );
void secmem_dump_stats(void);
void secmem_set_flags( unsigned flags );
unsigned secmem_get_flags(void);
# 102 "../include/memory.h"
int memory_debug_mode;
int memory_stat_debug_mode;
# 41 "iobuf.c" 2
# 1 "../include/util.h" 1
# 23 "../include/util.h"
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/compat/stdarg.h" 1 3
# 14 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/compat/stdarg.h" 3
# 1 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/stdarg.h" 1 3
# 47 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/stdarg.h" 3
# 1 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/__stdarg_header_macro.h" 1 3
# 48 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/stdarg.h" 2 3



# 1 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/__stdarg___gnuc_va_list.h" 1 3
# 12 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/__stdarg___gnuc_va_list.h" 3
typedef __builtin_va_list __gnuc_va_list;
# 52 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/stdarg.h" 2 3




# 1 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/__stdarg_va_list.h" 1 3
# 12 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/__stdarg_va_list.h" 3
typedef __builtin_va_list va_list;
# 57 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/stdarg.h" 2 3




# 1 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/__stdarg_va_arg.h" 1 3
# 62 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/stdarg.h" 2 3




# 1 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/__stdarg___va_copy.h" 1 3
# 67 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/stdarg.h" 2 3




# 1 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/__stdarg_va_copy.h" 1 3
# 72 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/stdarg.h" 2 3
# 15 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/compat/stdarg.h" 2 3
# 24 "../include/util.h" 2

# 1 "../include/types.h" 1
# 24 "../include/types.h"
# 1 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/inttypes.h" 1 3
# 24 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/inttypes.h" 3
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/inttypes.h" 1 3
# 12 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/inttypes.h" 3
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/bits/alltypes.h" 1 3
# 13 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/inttypes.h" 2 3

typedef struct { intmax_t quot, rem; } imaxdiv_t;

intmax_t imaxabs(intmax_t);
imaxdiv_t imaxdiv(intmax_t, intmax_t);

intmax_t strtoimax(const char *restrict, char **restrict, int);
uintmax_t strtoumax(const char *restrict, char **restrict, int);

intmax_t wcstoimax(const wchar_t *restrict, wchar_t **restrict, int);
uintmax_t wcstoumax(const wchar_t *restrict, wchar_t **restrict, int);
# 25 "/home/yang/wasm/emsdk/upstream/lib/clang/20/include/inttypes.h" 2 3
# 25 "../include/types.h" 2
# 49 "../include/types.h"
typedef unsigned char byte;
# 76 "../include/types.h"
typedef unsigned short u16;
# 86 "../include/types.h"
typedef unsigned int u32;
# 103 "../include/types.h"
typedef uint64_t u64;
# 126 "../include/types.h"
typedef union {
    int a;
    short b;
    char c[1];
    long d;

    u64 e;

    float f;
    double g;
} PROPERLY_ALIGNED_TYPE;

struct string_list {
    struct string_list *next;
    unsigned int flags;
    char d[1];
};
typedef struct string_list *STRLIST;
typedef struct string_list *strlist_t;
# 26 "../include/util.h" 2
# 1 "../include/errors.h" 1
# 27 "../include/util.h" 2

# 1 "../include/mpi.h" 1
# 32 "../include/mpi.h"
# 1 "../config.h" 1
# 33 "../include/mpi.h" 2

# 1 "../include/iobuf.h" 1
# 36 "../include/iobuf.h"
typedef struct iobuf_struct *IOBUF;
typedef struct iobuf_struct *iobuf_t;


struct iobuf_struct {
    int use;
    off_t nlimit;
    off_t nbytes;
    off_t ntotal;
    int nofast;
    void *directfp;
    struct {
 size_t size;
 size_t start;
 size_t len;
 byte *buf;
    } d;
    int filter_eof;
    int error;
    int (*filter)( void *opaque, int control,
     IOBUF chain, byte *buf, size_t *len);
    void *filter_ov;
    int filter_ov_owner;
    char *real_fname;
    IOBUF chain;
    int no, subno;
    void *opaque;

    struct {
 size_t size;
 size_t start;
 size_t len;
 byte *buf;
    } unget;
};
# 81 "../include/iobuf.h"
int iobuf_debug_mode;

void iobuf_enable_special_filenames ( int yes );
int iobuf_is_pipe_filename (const char *fname);
IOBUF iobuf_alloc(int use, size_t bufsize);
IOBUF iobuf_temp(void);
IOBUF iobuf_temp_with_content( const char *buffer, size_t length );
IOBUF iobuf_open( const char *fname );
IOBUF iobuf_fdopen( int fd, const char *mode );
IOBUF iobuf_sockopen( int fd, const char *mode );
IOBUF iobuf_create( const char *fname );
IOBUF iobuf_append( const char *fname );
IOBUF iobuf_openrw( const char *fname );
int iobuf_ioctl ( IOBUF a, int cmd, int intval, void *ptrval );
int iobuf_close( IOBUF iobuf );
int iobuf_cancel( IOBUF iobuf );

int iobuf_push_filter( IOBUF a, int (*f)(void *opaque, int control,
         IOBUF chain, byte *buf, size_t *len), void *ov );
int iobuf_push_filter2( IOBUF a,
      int (*f)(void *opaque, int control,
      IOBUF chain, byte *buf, size_t *len),
      void *ov, int rel_ov );
int iobuf_flush(IOBUF a);
void iobuf_clear_eof(IOBUF a);



void iobuf_set_limit( IOBUF a, off_t nlimit );

off_t iobuf_tell( IOBUF a );
int iobuf_seek( IOBUF a, off_t newpos );

int iobuf_readbyte(IOBUF a);
int iobuf_read(IOBUF a, byte *buf, unsigned buflen );
unsigned iobuf_read_line( IOBUF a, byte **addr_of_buffer,
     unsigned *length_of_buffer, unsigned *max_length );
int iobuf_peek(IOBUF a, byte *buf, unsigned buflen );
int iobuf_writebyte(IOBUF a, unsigned c);
int iobuf_write(IOBUF a, byte *buf, unsigned buflen );
int iobuf_writestr(IOBUF a, const char *buf );

void iobuf_flush_temp( IOBUF temp );
int iobuf_write_temp( IOBUF a, IOBUF temp );
size_t iobuf_temp_to_buffer( IOBUF a, byte *buffer, size_t buflen );
void iobuf_unget_and_close_temp( IOBUF a, IOBUF temp );

int iobuf_get_fd (IOBUF a);
off_t iobuf_get_filelength (IOBUF a, int *overflow);

const char *iobuf_get_real_fname( IOBUF a );
const char *iobuf_get_fname( IOBUF a );

void iobuf_set_partial_block_mode( IOBUF a, size_t len );

int iobuf_translate_file_handle ( int fd, int for_write );
# 160 "../include/iobuf.h"
void iobuf_skip_rest (IOBUF a, unsigned long n, int partial);
# 35 "../include/mpi.h" 2
# 49 "../include/mpi.h"
int mpi_debug_mode;


struct gcry_mpi;
typedef struct gcry_mpi *MPI;
# 72 "../include/mpi.h"
MPI mpi_alloc( unsigned nlimbs );
MPI mpi_alloc_secure( unsigned nlimbs );
MPI mpi_alloc_like( MPI a );
void mpi_free( MPI a );
void mpi_resize( MPI a, unsigned nlimbs );
MPI mpi_copy( MPI a );


MPI mpi_set_opaque( MPI a, void *p, unsigned int len );
void *mpi_get_opaque( MPI a, unsigned int *len );

void mpi_set_secure( MPI a );
void mpi_clear( MPI a );
void mpi_set( MPI w, MPI u);
void mpi_set_cond( MPI w, MPI u, unsigned long set);
void mpi_set_ui( MPI w, ulong u);
MPI mpi_alloc_set_ui( unsigned long u);
void mpi_m_check( MPI a );
void mpi_swap( MPI a, MPI b);
int mpi_get_nlimbs (MPI a);
int mpi_is_neg (MPI a);
unsigned int mpi_nlimb_hint_from_nbytes (unsigned int nbytes);
unsigned int mpi_nlimb_hint_from_nbits (unsigned int nbits);
unsigned int mpi_get_flags (MPI a);


int mpi_write( IOBUF out, MPI a );




MPI mpi_read(IOBUF inp, unsigned *nread, int secure);

MPI mpi_read_from_buffer(byte *buffer, unsigned *ret_nread, int secure);
int mpi_fromstr(MPI val, const char *str);
int mpi_print( FILE *fp, MPI a, int mode );
void g10_log_mpidump( const char *text, MPI a );
u32 mpi_get_keyid( MPI a, u32 *keyid );
byte *mpi_get_buffer( MPI a, unsigned *nbytes, int *sign );
byte *mpi_get_secure_buffer( MPI a, unsigned *nbytes, int *sign );
void mpi_set_buffer( MPI a, const byte *buffer, unsigned nbytes, int sign );




void mpi_add_ui(MPI w, MPI u, ulong v );
void mpi_add(MPI w, MPI u, MPI v);
void mpi_addm(MPI w, MPI u, MPI v, MPI m);
void mpi_sub_ui(MPI w, MPI u, ulong v );
void mpi_sub( MPI w, MPI u, MPI v);
void mpi_subm( MPI w, MPI u, MPI v, MPI m);


void mpi_mul_ui(MPI w, MPI u, ulong v );
void mpi_mul_2exp( MPI w, MPI u, ulong cnt);
void mpi_mul( MPI w, MPI u, MPI v);
void mpi_mulm( MPI w, MPI u, MPI v, MPI m);


ulong mpi_fdiv_r_ui( MPI rem, MPI dividend, ulong divisor );
void mpi_fdiv_r( MPI rem, MPI dividend, MPI divisor );
void mpi_fdiv_q( MPI quot, MPI dividend, MPI divisor );
void mpi_fdiv_qr( MPI quot, MPI rem, MPI dividend, MPI divisor );
void mpi_tdiv_r( MPI rem, MPI num, MPI den);
void mpi_tdiv_qr( MPI quot, MPI rem, MPI num, MPI den);
void mpi_tdiv_q_2exp( MPI w, MPI u, unsigned count );
int mpi_divisible_ui(MPI dividend, ulong divisor );


int mpi_gcd( MPI g, MPI a, MPI b );


void mpi_pow( MPI w, MPI u, MPI v);
void mpi_powm( MPI res, MPI base, MPI exponent, MPI mod);


void mpi_mulpowm( MPI res, MPI *basearray, MPI *exparray, MPI mod);


int mpi_cmp_ui( MPI u, ulong v );
int mpi_cmp( MPI u, MPI v );


int mpi_getbyte( MPI a, unsigned idx );
void mpi_putbyte( MPI a, unsigned idx, int value );
unsigned mpi_trailing_zeros( MPI a );


void mpi_normalize( MPI a );
unsigned mpi_get_nbits( MPI a );
int mpi_test_bit( MPI a, unsigned n );
void mpi_set_bit( MPI a, unsigned n );
void mpi_set_highbit( MPI a, unsigned n );
void mpi_clear_highbit( MPI a, unsigned n );
void mpi_clear_bit( MPI a, unsigned n );
void mpi_rshift( MPI x, MPI a, unsigned n );


void mpi_invm( MPI x, MPI u, MPI v );
# 29 "../include/util.h" 2
# 1 "../include/compat.h" 1







int hextobyte( const char *s );
int ascii_toupper (int c);
int ascii_tolower (int c);
int ascii_strcasecmp( const char *a, const char *b );
int ascii_strncasecmp( const char *a, const char *b, size_t n);






char *xstrconcat (const char *s1, ...) __attribute__ ((sentinel(0)));
# 30 "../include/util.h" 2
# 39 "../include/util.h"
typedef struct {
     int *argc;
     char ***argv;
     unsigned flags;
     int err;

     int r_opt;
     int r_type;
     union {
  int ret_int;
  long ret_long;
  ulong ret_ulong;
  char *ret_str;
     } r;
     struct {
  int idx;
  int inarg;
  int stopped;
  const char *last;
  void *aliases;
  const void *cur_alias;
         void *iio_list;
     } internal;
} ARGPARSE_ARGS;

typedef struct {
    int short_opt;
    const char *long_opt;
    unsigned flags;
    const char *description;
} ARGPARSE_OPTS;


void log_set_logfile( const char *name, int fd );
FILE *log_stream(void);
void g10_log_print_prefix(const char *text);
void log_set_name( const char *name );
const char *log_get_name(void);
void log_set_pid( int pid );
int log_get_errorcount( int clear );
void log_inc_errorcount(void);
int log_set_strict(int val);
void g10_log_hexdump( const char *text, const char *buf, size_t len );



  void g10_log_bug( const char *fmt, ... )
       __attribute__ ((noreturn, format (printf,1,2)));
  void g10_log_bug0( const char *, int, const char * ) __attribute__ ((noreturn));
  void g10_log_fatal( const char *fmt, ... )
       __attribute__ ((noreturn, format (printf,1,2)));
  void g10_log_error( const char *fmt, ... ) __attribute__ ((format (printf,1,2)));
  void g10_log_info( const char *fmt, ... ) __attribute__ ((format (printf,1,2)));
  void g10_log_warning( const char *fmt, ... ) __attribute__ ((format (printf,1,2)));
  void g10_log_debug( const char *fmt, ... ) __attribute__ ((format (printf,1,2)));
# 121 "../include/util.h"
const char * g10_errstr( int no );


int arg_parse( ARGPARSE_ARGS *arg, ARGPARSE_OPTS *opts);
int optfile_parse( FILE *fp, const char *filename, unsigned *lineno,
     ARGPARSE_ARGS *arg, ARGPARSE_OPTS *opts);
void usage( int level );
const char *default_strusage( int level );



const char *strusage( int level );



# 1 "../include/../include/dotlock.h" 1
# 97 "../include/../include/dotlock.h"
struct dotlock_handle;
typedef struct dotlock_handle *dotlock_t;

void dotlock_disable (void);
dotlock_t dotlock_create (const char *file_to_lock, unsigned int flags);
void dotlock_set_fd (dotlock_t h, int fd);
int dotlock_get_fd (dotlock_t h);
void dotlock_destroy (dotlock_t h, int reclaim);
int dotlock_take (dotlock_t h, long timeout);
int dotlock_release (dotlock_t h);
void dotlock_remove_lockfiles (int reclaim);
void dotlock_remove_lockfiles_reclaim (void);
# 137 "../include/util.h" 2


char * make_basename(const char *filepath, const char *inputpath);
char * make_dirname(const char *filepath);
char *make_filename( const char *first_part, ... );
int compare_filenames( const char *a, const char *b );
int same_file_p (const char *name1, const char *name2);
const char *print_fname_stdin( const char *s );
const char *print_fname_stdout( const char *s );
int is_file_compressed(const char *s, int *r_status);


u32 make_timestamp(void);
u32 scan_isodatestr( const char *string );
u32 isotime2seconds (const char *string);
const char *strtimevalue( u32 stamp );
const char *strtimestamp( u32 stamp );
const char *isotimestamp( u32 stamp );
const char *asctimestamp( u32 stamp );
void print_string( FILE *fp, const byte *p, size_t n, int delim );
void print_string2( FILE *fp, const byte *p, size_t n, int delim, int delim2 );
void print_utf8_string( FILE *fp, const byte *p, size_t n );
void print_utf8_string2( FILE *fp, const byte *p, size_t n, int delim);
char *make_printable_string( const byte *p, size_t n, int delim );
int answer_is_yes_no_default( const char *s, int def_answer );
int answer_is_yes( const char *s );
int answer_is_yes_no_quit( const char *s );
int answer_is_okay_cancel (const char *s, int def_answer);
int match_multistr(const char *multistr,const char *match);


void free_strlist( STRLIST sl );

STRLIST add_to_strlist( STRLIST *list, const char *string );
STRLIST add_to_strlist2( STRLIST *list, const char *string, int is_utf8 );
STRLIST append_to_strlist( STRLIST *list, const char *string );
STRLIST append_to_strlist2( STRLIST *list, const char *string, int is_utf8 );
STRLIST strlist_prev( STRLIST head, STRLIST node );
STRLIST strlist_last( STRLIST node );
char *pop_strlist( STRLIST *list );
const char *memistr( const char *buf, size_t buflen, const char *sub );
const char *ascii_memistr( const char *buf, size_t buflen, const char *sub );
char *mem2str( char *, const void *, size_t);
char *trim_spaces( char *string );
unsigned int trim_trailing_chars( byte *line, unsigned int len,
                                  const char *trimchars);
unsigned int trim_trailing_ws( byte *line, unsigned len );
unsigned int check_trailing_chars( const byte *line, unsigned int len,
                                   const char *trimchars );
unsigned int check_trailing_ws( const byte *line, unsigned int len );
int string_count_chr( const char *string, int c );
int has_invalid_email_chars (const char *s);
int is_valid_mailbox (const char *name);
int set_native_charset( const char *newset );
const char* get_native_charset(void);
char *native_to_utf8( const char *string );
char *utf8_to_native( const char *string, size_t length, int delim);
char *string_to_utf8 (const char *string);

int ascii_isupper (int c);
int ascii_islower (int c);
int ascii_memcasecmp( const char *a, const char *b, size_t n);
char *ascii_strlwr (char *s);
# 223 "../include/util.h"
struct private_membuf_s {
  size_t len;
  size_t size;
  char *buf;
  int out_of_core;
};

typedef struct private_membuf_s membuf_t;

void init_membuf (membuf_t *mb, int initiallen);
void put_membuf (membuf_t *mb, const void *buf, size_t len);
void put_membuf_str (membuf_t *mb, const char *buf);
void *get_membuf (membuf_t *mb, size_t *len);
# 249 "../include/util.h"
char *xasprintf (const char *fmt, ...);
char *xtryasprintf (const char *fmt, ...);
char *xtryvasprintf (const char *fmt, va_list arg_ptr);
char *strconcat (const char *s1, ...) __attribute__ ((sentinel(0)));


char *get_pka_info (const char *address, void *fprbuf, size_t fprbuflen);


int get_cert (const char *name, int want_ipgp, size_t max_size, IOBUF *iobuf,
              unsigned char **fpr,size_t *fpr_len,char **url);


int hex2bin (const char *string, void *buffer, size_t length);
int hexcolon2bin (const char *string, void *buffer, size_t length);
char *bin2hex (const void *buffer, size_t length, char *stringbuf);
char *bin2hexcolon (const void *buffer, size_t length, char *stringbuf);
const char *hex2str (const char *hexstring,
                     char *buffer, size_t bufsize, size_t *buflen);
char *hex2str_alloc (const char *hexstring, size_t *r_count);
# 42 "iobuf.c" 2
# 1 "../include/dynload.h" 1
# 24 "../include/dynload.h"
# 1 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/dlfcn.h" 1 3
# 22 "/home/yang/wasm/emsdk/upstream/emscripten/cache/sysroot/include/dlfcn.h" 3
int dlclose(void *);
char *dlerror(void);
void *dlopen(const char *, int);
void *dlsym(void *restrict, const char *restrict);


typedef struct {
 const char *dli_fname;
 void *dli_fbase;
 const char *dli_sname;
 void *dli_saddr;
} Dl_info;
int dladdr(const void *, Dl_info *);
int dlinfo(void *, int, void *);
# 25 "../include/dynload.h" 2
# 43 "iobuf.c" 2
# 93 "iobuf.c"
typedef int FILEP_OR_FD;




typedef struct {
     FILEP_OR_FD fp;
     int keep_open;
     int no_cache;
     int eof_seen;
     int print_only_name;
     char fname[1];
 } file_filter_ctx_t ;

 struct close_cache_s {
    struct close_cache_s *next;
    FILEP_OR_FD fp;
    char fname[1];
 };
 typedef struct close_cache_s *CLOSE_CACHE;
 static CLOSE_CACHE close_cache;
# 133 "iobuf.c"
typedef struct {
    int use;
    size_t size;
    size_t count;
    int partial;
    char *buffer;
    size_t buflen;
    int first_c;
    int eof;
} block_filter_ctx_t;

static int special_names_enabled;

static int underflow(IOBUF a);
static int translate_file_handle ( int fd, int for_write );







static int
fd_cache_strcmp (const char *a, const char *b)
{
# 167 "iobuf.c"
  return strcmp (a, b);

}





static int
fd_cache_invalidate (const char *fname)
{
    CLOSE_CACHE cc;
    int err=0;

    if (!fname) {
        if( iobuf_debug_mode )
            g10_log_debug ("fd_cache_invalidate (all)\n");

        for (cc=close_cache; cc; cc = cc->next ) {
            if ( cc->fp != (-1) ) {



                close(cc->fp);

                cc->fp = (-1);
            }
        }
        return err;
    }

    if( iobuf_debug_mode )
        g10_log_debug ("fd_cache_invalidate (%s)\n", fname);

    for (cc=close_cache; cc; cc = cc->next ) {
        if ( cc->fp != (-1) && !fd_cache_strcmp (cc->fname, fname) ) {
            if( iobuf_debug_mode )
                g10_log_debug ("                did (%s)\n", cc->fname);




     err=close(cc->fp);

            cc->fp = (-1);
        }
    }

    return err;
}

static int
fd_cache_synchronize(const char *fname)
{
  int err=0;


  CLOSE_CACHE cc;

  if( iobuf_debug_mode )
    g10_log_debug ("fd_cache_synchronize (%s)\n", fname);

  for (cc=close_cache; cc; cc = cc->next )
    {
      if ( cc->fp != (-1) && !fd_cache_strcmp (cc->fname, fname) )
 {
   if( iobuf_debug_mode )
     g10_log_debug ("                did (%s)\n", cc->fname);

   err=fsync(cc->fp);
 }
    }


  return err;
}

static FILEP_OR_FD
direct_open (const char *fname, const char *mode)
{
# 278 "iobuf.c"
    int oflag;
    int cflag = 0400|0200|0040|0020|0004|0002;


    if ( strchr (mode, '+') ) {
        fd_cache_invalidate (fname);
        oflag = 02;
    }
    else if ( strchr (mode, 'w') ) {
        fd_cache_invalidate (fname);
        oflag = 01 | 0100 | 01000;
    }
    else {
        oflag = 00;
    }





    return open (fname, oflag, cflag );
# 312 "iobuf.c"
}






static void
fd_cache_close (const char *fname, FILEP_OR_FD fp)
{
    CLOSE_CACHE cc;

    ((void)((fp) || (__assert_fail("fp", "iobuf.c", 324, __func__),0)));
    if ( !fname || !*fname ) {



        close(fp);

        if( iobuf_debug_mode )
          g10_log_debug ("fd_cache_close (%d) real\n", (int)fp);
        return;
    }

    for (cc=close_cache; cc; cc = cc->next ) {
        if ( cc->fp == (-1) && !fd_cache_strcmp (cc->fname, fname) ) {
            cc->fp = fp;
            if( iobuf_debug_mode )
                g10_log_debug ("fd_cache_close (%s) used existing slot\n", fname);
            return;
        }
    }

    if( iobuf_debug_mode )
        g10_log_debug ("fd_cache_close (%s) new slot created\n", fname);
    cc = xmalloc_clear (sizeof *cc + strlen (fname));
    strcpy (cc->fname, fname);
    cc->fp = fp;
    cc->next = close_cache;
    close_cache = cc;
}




static FILEP_OR_FD
fd_cache_open (const char *fname, const char *mode)
{
    CLOSE_CACHE cc;

    ((void)((fname) || (__assert_fail("fname", "iobuf.c", 362, __func__),0)));
    for (cc=close_cache; cc; cc = cc->next ) {
        if ( cc->fp != (-1) && !fd_cache_strcmp (cc->fname, fname) ) {
            FILEP_OR_FD fp = cc->fp;
            cc->fp = (-1);
            if( iobuf_debug_mode )
                g10_log_debug ("fd_cache_open (%s) using cached fp\n", fname);







            if ( lseek (fp, 0, (0)) == (off_t)-1 ) {
                g10_log_error("can't rewind fd %d: %s\n", fp, strerror((*__errno_location())) );
                fp = (-1);
            }

            return fp;
        }
    }
    if( iobuf_debug_mode )
        g10_log_debug ("fd_cache_open (%s) not cached\n", fname);
    return direct_open (fname, mode);
}
# 417 "iobuf.c"
static int
file_filter(void *opaque, int control, IOBUF chain, byte *buf, size_t *ret_len)
{
    file_filter_ctx_t *a = opaque;
    FILEP_OR_FD f = a->fp;
    size_t size = *ret_len;
    size_t nbytes = 0;
    int rc = 0;
# 476 "iobuf.c"
    if( control == 3 ) {
 ((void)((size) || (__assert_fail("size", "iobuf.c", 477, __func__),0)));
 if ( a->eof_seen) {
     rc = -1;
     *ret_len = 0;
 }
 else {
# 504 "iobuf.c"
            int n;

            nbytes = 0;
            do {
                n = read ( f, buf, size );
            } while (n == -1 && (*__errno_location()) == (27) );
            if ( n == -1 ) {
                if ((*__errno_location()) != (64)) {
                    g10_log_error("%s: read error: %s\n",
                              a->fname, strerror((*__errno_location())));
                    rc = 21;
                }
            }
            else if ( !n ) {
                a->eof_seen = 1;
                rc = -1;
            }
            else {
                nbytes = n;
            }

     *ret_len = nbytes;
 }
    }
    else if( control == 4 ) {
 if( size ) {
# 547 "iobuf.c"
            byte *p = buf;
            int n;

            nbytes = size;
            do {
                do {
                    n = write ( f, p, nbytes );
                } while ( n == -1 && (*__errno_location()) == (27) );
                if ( n > 0 ) {
                    p += n;
                    nbytes -= n;
                }
            } while ( n != -1 && nbytes );
     if( n == -1 ) {
  g10_log_error("%s: write error: %s\n", a->fname, strerror((*__errno_location())));
  rc = 22;
     }
            nbytes = p - buf;

 }
 *ret_len = nbytes;
    }
    else if ( control == 1 ) {
        a->eof_seen = 0;
        a->keep_open = 0;
        a->no_cache = 0;
    }
    else if ( control == 5 ) {
        mem2str (buf, "file_filter(fd)", *ret_len);
    }
    else if ( control == 2 ) {
# 586 "iobuf.c"
 if ( (int)f != 0 && (int)f != 1 ) {
     if( iobuf_debug_mode )
  g10_log_debug("%s: close fd %d\n", a->fname, f );
            if (!a->keep_open)
                fd_cache_close (a->no_cache?((void*)0):a->fname, f);
 }
 f = (-1);

 xfree (a);
    }

    return rc;
}
# 679 "iobuf.c"
static int
block_filter(void *opaque, int control, IOBUF chain, byte *buf, size_t *ret_len)
{
    block_filter_ctx_t *a = opaque;
    size_t size = *ret_len;
    int c, needed, rc = 0;
    char *p;

    if( control == 3 ) {
 size_t n=0;

 p = buf;
 ((void)((size) || (__assert_fail("size", "iobuf.c", 691, __func__),0)));
 if( a->eof )
     rc = -1;
 while( !rc && size ) {
     if( !a->size ) {
  if( a->partial == 2 ) {
      a->eof = 1;
      if( !n )
   rc = -1;
      break;
  }
  else if( a->partial ) {


      if( a->first_c ) {
   c = a->first_c;
   a->first_c = 0;
      }
      else if( (c = ( ((chain)->nofast || (chain)->d.start >= (chain)->d.len )? iobuf_readbyte((chain)) : ( (chain)->nbytes++, (chain)->d.buf[(chain)->d.start++] ) )) == -1 ) {
   g10_log_error("block_filter: 1st length byte missing\n");
   rc = 21;
   break;
      }
      if( c < 192 ) {
   a->size = c;
   a->partial = 2;
   if( !a->size ) {
       a->eof = 1;
       if( !n )
    rc = -1;
       break;
   }
      }
      else if( c < 224 ) {
   a->size = (c - 192) * 256;
   if( (c = ( ((chain)->nofast || (chain)->d.start >= (chain)->d.len )? iobuf_readbyte((chain)) : ( (chain)->nbytes++, (chain)->d.buf[(chain)->d.start++] ) )) == -1 ) {
       g10_log_error("block_filter: 2nd length byte missing\n");
       rc = 21;
       break;
   }
   a->size += c + 192;
   a->partial = 2;
   if( !a->size ) {
       a->eof = 1;
       if( !n )
    rc = -1;
       break;
   }
      }
      else if( c == 255 ) {
                        a->size = (size_t)( ((chain)->nofast || (chain)->d.start >= (chain)->d.len )? iobuf_readbyte((chain)) : ( (chain)->nbytes++, (chain)->d.buf[(chain)->d.start++] ) ) << 24;
   a->size |= ( ((chain)->nofast || (chain)->d.start >= (chain)->d.len )? iobuf_readbyte((chain)) : ( (chain)->nbytes++, (chain)->d.buf[(chain)->d.start++] ) ) << 16;
   a->size |= ( ((chain)->nofast || (chain)->d.start >= (chain)->d.len )? iobuf_readbyte((chain)) : ( (chain)->nbytes++, (chain)->d.buf[(chain)->d.start++] ) ) << 8;
   if( (c = ( ((chain)->nofast || (chain)->d.start >= (chain)->d.len )? iobuf_readbyte((chain)) : ( (chain)->nbytes++, (chain)->d.buf[(chain)->d.start++] ) )) == -1 ) {
       g10_log_error("block_filter: invalid 4 byte length\n");
       rc = 21;
       break;
   }
   a->size |= c;
   a->partial = 2;
   if( !a->size ) {
       a->eof = 1;
       if( !n )
    rc = -1;
       break;
   }
      }
      else {
   a->size = 1 << (c & 0x1f);
      }

  }
  else
    g10_log_bug0( "iobuf.c" , 764, __FUNCTION__ );
     }

     while( !rc && size && a->size ) {
  needed = size < a->size ? size : a->size;
  c = iobuf_read( chain, p, needed );
  if( c < needed ) {
      if( c == -1 ) c = 0;
      g10_log_error("block_filter %p: read error (size=%lu,a->size=%lu)\n",
         a, (ulong)size+c, (ulong)a->size+c);
      rc = 21;
  }
  else {
      size -= c;
      a->size -= c;
      p += c;
      n += c;
  }
     }
 }
 *ret_len = n;
    }
    else if( control == 4 ) {
 if( a->partial ) {
     size_t blen, n, nbytes = size + a->buflen;

     ((void)((a->buflen <= 512) || (__assert_fail("a->buflen <= OP_MIN_PARTIAL_CHUNK", "iobuf.c", 790, __func__),0)));
     if( nbytes < 512 ) {

  if( !a->buffer )
      a->buffer = xmalloc( 512 );
  memcpy( a->buffer + a->buflen, buf, size );
  a->buflen += size;
     }
     else {

  p = buf;
  do {


      for( blen=512*2,
       c=9 +1; blen <= nbytes;
           blen *=2, c++ )
   ;
      blen /= 2; c--;

      ((void)((c <= 0x1f) || (__assert_fail("c <= 0x1f", "iobuf.c", 810, __func__),0)));
      c |= 0xe0;
      iobuf_writebyte(chain,c);
      if( (n=a->buflen) ) {
   ((void)((n == 512) || (__assert_fail("n == OP_MIN_PARTIAL_CHUNK", "iobuf.c", 814, __func__),0)));
   if( iobuf_write(chain, a->buffer, n ) )
       rc = 22;
   a->buflen = 0;
   nbytes -= n;
      }
      if( (n = nbytes) > blen )
   n = blen;
      if( n && iobuf_write(chain, p, n ) )
   rc = 22;
      p += n;
      nbytes -= n;
  } while( !rc && nbytes >= 512 );

  if( !rc && nbytes ) {
      ((void)((!a->buflen) || (__assert_fail("!a->buflen", "iobuf.c", 829, __func__),0)));
      ((void)((nbytes < 512) || (__assert_fail("nbytes < OP_MIN_PARTIAL_CHUNK", "iobuf.c", 830, __func__),0)));
      if( !a->buffer )
   a->buffer = xmalloc( 512 );
      memcpy( a->buffer, p, nbytes );
      a->buflen = nbytes;
  }
     }
 }
 else
   g10_log_bug0( "iobuf.c" , 839, __FUNCTION__ );
    }
    else if( control == 1 ) {
 if( iobuf_debug_mode )
     g10_log_debug("init block_filter %p\n", a );
 if( a->partial )
     a->count = 0;
 else if( a->use == 1 )
     a->count = a->size = 0;
 else
     a->count = a->size;
 a->eof = 0;
 a->buffer = ((void*)0);
 a->buflen = 0;
    }
    else if( control == 5 ) {
        mem2str (buf, "block_filter", *ret_len);
    }
    else if( control == 2 ) {
 if( a->use == 2 ) {
     if( a->partial ) {
  u32 len;
# 872 "iobuf.c"
  len = a->buflen;

  if( len < 192 )
      rc = iobuf_writebyte(chain,len);
  else if( len < 8384 ) {
      if( !(rc=iobuf_writebyte(chain,((len-192) / 256) + 192)) )
   rc = iobuf_writebyte(chain,((len-192) % 256));
  }
  else {
      if( !(rc=iobuf_writebyte(chain,0xff)) )
   if( !(rc=iobuf_writebyte(chain,(len >> 24)&0xff)) )
       if( !(rc=iobuf_writebyte(chain,(len >> 16)&0xff)) )
    if( !(rc=iobuf_writebyte(chain,(len >> 8)&0xff)))
        rc=iobuf_writebyte(chain,len & 0xff);
  }
  if( !rc && len )
      rc = iobuf_write(chain, a->buffer, len );
  if( rc ) {
      g10_log_error("block_filter: write error: %s\n",strerror((*__errno_location())));
      rc = 22;
  }
  xfree( a->buffer ); a->buffer = ((void*)0); a->buflen = 0;
     }
     else
       g10_log_bug0( "iobuf.c" , 896, __FUNCTION__ );
 }
 else if( a->size ) {
     g10_log_error("block_filter: pending bytes!\n");
 }
 if( iobuf_debug_mode )
     g10_log_debug("free block_filter %p\n", a );
 xfree(a);
    }

    return rc;
}







static const char *
iobuf_desc (iobuf_t a, byte *buf)
{
  size_t len = 32;

  if (! a || ! a->filter)
    memcpy (buf, "?", 2);
  else
    a->filter (a->filter_ov, 5, ((void*)0), buf, &len);

  return buf;
}

static void
print_chain( IOBUF a )
{
    if( !iobuf_debug_mode )
 return;
    for(; a; a = a->chain ) {
        byte desc[32];

 g10_log_debug("iobuf chain: %d.%d `%s' filter_eof=%d start=%d len=%d\n",
    a->no, a->subno, iobuf_desc (a, desc), a->filter_eof,
    (int)a->d.start, (int)a->d.len );
    }
}

int
iobuf_print_chain( IOBUF a )
{
    print_chain(a);
    return 0;
}






IOBUF
iobuf_alloc(int use, size_t bufsize)
{
    IOBUF a;
    static int number=0;

    a = xmalloc_clear(sizeof *a);
    a->use = use;
    a->d.buf = xmalloc( bufsize );
    a->d.size = bufsize;
    a->no = ++number;
    a->subno = 0;
    a->opaque = ((void*)0);
    a->real_fname = ((void*)0);
    return a;
}

int
iobuf_close ( IOBUF a )
{
    IOBUF a2;
    size_t dummy_len=0;
    int rc=0;

    if( a && a->directfp ) {
 fclose( a->directfp );
 xfree( a->real_fname );
 if( iobuf_debug_mode )
     g10_log_debug("iobuf_close -> %p\n", a->directfp );
 return 0;
    }

    for( ; a && !rc ; a = a2 ) {
        byte desc[32];
 a2 = a->chain;
 if( a->use == 2 && (rc=iobuf_flush(a)) )
     g10_log_error("iobuf_flush failed on close: %s\n", g10_errstr(rc));

 if( iobuf_debug_mode )
     g10_log_debug("iobuf-%d.%d: close `%s'\n", a->no, a->subno,
                      iobuf_desc (a, desc));
 if( a->filter && (rc = a->filter(a->filter_ov, 2,
      a->chain, ((void*)0), &dummy_len)) )
     g10_log_error("IOBUFCTRL_FREE failed on close: %s\n", g10_errstr(rc) );
 xfree(a->real_fname);
        if (a->d.buf) {
            memset (a->d.buf, 0, a->d.size);
            xfree(a->d.buf);
        }
 xfree(a);
    }
    return rc;
}

int
iobuf_cancel( IOBUF a )
{
    const char *s;
    IOBUF a2;
    int rc;




    if( a && a->use == 2 ) {
 s = iobuf_get_real_fname(a);
 if( s && *s ) {



     remove(s);

 }
    }


    for( a2 = a; a2 ; a2 = a2->chain ) {
 size_t dummy;
 if( a2->filter )
     a2->filter( a2->filter_ov, 6, a2->chain,
        ((void*)0), &dummy );
    }

    rc = iobuf_close(a);
# 1046 "iobuf.c"
    return rc;
}







IOBUF
iobuf_temp()
{
    IOBUF a;

    a = iobuf_alloc(3, 8192 );

    return a;
}

IOBUF
iobuf_temp_with_content( const char *buffer, size_t length )
{
    IOBUF a;

    a = iobuf_alloc(3, length );
    memcpy( a->d.buf, buffer, length );
    a->d.len = length;

    return a;
}

void
iobuf_enable_special_filenames ( int yes )
{
    special_names_enabled = yes;
}






static int
check_special_filename ( const char *fname )
{
    if ( special_names_enabled
         && fname && *fname == '-' && fname[1] == '&' ) {
        int i;

        fname += 2;
        for (i=0; (*(fname+i) >= '0' && *(fname+i) <= '9'); i++ )
            ;
        if ( !fname[i] )
            return atoi (fname);
    }
    return -1;
}



int
iobuf_is_pipe_filename (const char *fname)
{
  if (!fname || (*fname=='-' && !fname[1]) )
    return 1;
  return check_special_filename (fname) != -1;
}





IOBUF
iobuf_open( const char *fname )
{
    IOBUF a;
    FILEP_OR_FD fp;
    file_filter_ctx_t *fcx;
    size_t len = 0;
    int print_only = 0;
    int fd;

    if( !fname || (*fname=='-' && !fname[1]) ) {
 fp = (0);



 fname = "[stdin]";
 print_only = 1;
    }
    else if ( (fd = check_special_filename ( fname )) != -1 )
        return iobuf_fdopen ( translate_file_handle (fd,0), "rb" );
    else if( (fp = fd_cache_open ((fname),("rb"))) == (-1) )
 return ((void*)0);
    a = iobuf_alloc(1, 8192 );
    fcx = xmalloc( sizeof *fcx + strlen(fname) );
    fcx->fp = fp;
    fcx->print_only_name = print_only;
    strcpy(fcx->fname, fname );
    if( !print_only )
 a->real_fname = xstrdup( fname );
    a->filter = file_filter;
    a->filter_ov = fcx;
    file_filter( fcx, 1, ((void*)0), ((void*)0), &len );
    if( iobuf_debug_mode )
 g10_log_debug("iobuf-%d.%d: open `%s' fd=%d\n",
     a->no, a->subno, fname, (int)(fcx->fp) );

    return a;
}





IOBUF
iobuf_fdopen( int fd, const char *mode )
{
    IOBUF a;
    FILEP_OR_FD fp;
    file_filter_ctx_t *fcx;
    size_t len;





    fp = (FILEP_OR_FD)fd;

    a = iobuf_alloc( strchr( mode, 'w')? 2:1, 8192 );
    fcx = xmalloc( sizeof *fcx + 20 );
    fcx->fp = fp;
    fcx->print_only_name = 1;
    sprintf(fcx->fname, "[fd %d]", fd );
    a->filter = file_filter;
    a->filter_ov = fcx;
    file_filter( fcx, 1, ((void*)0), ((void*)0), &len );
    if( iobuf_debug_mode )
 g10_log_debug("iobuf-%d.%d: fdopen `%s'\n", a->no, a->subno, fcx->fname );
    iobuf_ioctl (a,3,1,((void*)0));
    return a;
}


IOBUF
iobuf_sockopen ( int fd, const char *mode )
{
    IOBUF a;
# 1210 "iobuf.c"
    a = iobuf_fdopen (fd, mode);

    return a;
}




IOBUF
iobuf_create( const char *fname )
{
    IOBUF a;
    FILEP_OR_FD fp;
    file_filter_ctx_t *fcx;
    size_t len;
    int print_only = 0;
    int fd;
    byte desc[32];

    if( !fname || (*fname=='-' && !fname[1]) ) {
 fp = (1);



 fname = "[stdout]";
 print_only = 1;
    }
    else if ( (fd = check_special_filename ( fname )) != -1 )
        return iobuf_fdopen ( translate_file_handle (fd, 1), "wb" );
    else if( (fp = direct_open ((fname),("wb"))) == (-1) )
 return ((void*)0);
    a = iobuf_alloc(2, 8192 );
    fcx = xmalloc( sizeof *fcx + strlen(fname) );
    fcx->fp = fp;
    fcx->print_only_name = print_only;
    strcpy(fcx->fname, fname );
    if( !print_only )
 a->real_fname = xstrdup( fname );
    a->filter = file_filter;
    a->filter_ov = fcx;
    file_filter( fcx, 1, ((void*)0), ((void*)0), &len );
    if( iobuf_debug_mode )
 g10_log_debug("iobuf-%d.%d: create `%s'\n", a->no, a->subno,
                  iobuf_desc (a, desc));

    return a;
}
# 1293 "iobuf.c"
IOBUF
iobuf_openrw( const char *fname )
{
    IOBUF a;
    FILEP_OR_FD fp;
    file_filter_ctx_t *fcx;
    size_t len;
    byte desc[32];

    if( !fname )
 return ((void*)0);
    else if( (fp = direct_open ((fname),("r+b"))) == (-1) )
 return ((void*)0);
    a = iobuf_alloc(2, 8192 );
    fcx = xmalloc( sizeof *fcx + strlen(fname) );
    fcx->fp = fp;
    strcpy(fcx->fname, fname );
    a->real_fname = xstrdup( fname );
    a->filter = file_filter;
    a->filter_ov = fcx;
    file_filter( fcx, 1, ((void*)0), ((void*)0), &len );
    if( iobuf_debug_mode )
 g10_log_debug("iobuf-%d.%d: openrw `%s'\n", a->no, a->subno,
                  iobuf_desc (a, desc));

    return a;
}


int
iobuf_ioctl ( IOBUF a, int cmd, int intval, void *ptrval )
{
    byte desc[32];

    if ( cmd == 1 ) {
        if( iobuf_debug_mode )
            g10_log_debug("iobuf-%d.%d: ioctl `%s' keep=%d\n",
                      a? a->no:-1, a?a->subno:-1,
                      iobuf_desc (a, desc), intval );
        for( ; a; a = a->chain )
            if( !a->chain && a->filter == file_filter ) {
                file_filter_ctx_t *b = a->filter_ov;
                b->keep_open = intval;
                return 0;
            }







    }
    else if ( cmd == 2 ) {
        if( iobuf_debug_mode )
            g10_log_debug("iobuf-*.*: ioctl `%s' invalidate\n",
                      ptrval? (char*)ptrval:"[all]");
        if ( !a && !intval ) {

     return fd_cache_invalidate (ptrval);

            return 0;
  }
    }
    else if ( cmd == 3 ) {
        if( iobuf_debug_mode )
            g10_log_debug("iobuf-%d.%d: ioctl `%s' no_cache=%d\n",
                      a? a->no:-1, a?a->subno:-1,
                      iobuf_desc (a, desc), intval );
        for( ; a; a = a->chain )
            if( !a->chain && a->filter == file_filter ) {
                file_filter_ctx_t *b = a->filter_ov;
                b->no_cache = intval;
                return 0;
            }







    }
    else if(cmd==4)
      {


        if( iobuf_debug_mode )
   g10_log_debug("iobuf-*.*: ioctl `%s' fsync\n",
                      ptrval? (char*)ptrval:"<null>");

 if(!a && !intval && ptrval)
   {

     return fd_cache_synchronize (ptrval);



   }
      }

    return -1;
}





int
iobuf_push_filter( IOBUF a,
     int (*f)(void *opaque, int control,
     IOBUF chain, byte *buf, size_t *len), void *ov )
{
    return iobuf_push_filter2( a, f, ov, 0 );
}

int
iobuf_push_filter2( IOBUF a,
      int (*f)(void *opaque, int control,
      IOBUF chain, byte *buf, size_t *len),
      void *ov, int rel_ov )
{
    IOBUF b;
    size_t dummy_len=0;
    int rc=0;

    if( a->directfp )
 g10_log_bug0( "iobuf.c" , 1420, __FUNCTION__ );

    if( a->use == 2 && (rc=iobuf_flush(a)) )
 return rc;

    if (a->subno >= 64) {
        g10_log_error ("i/o filter too deeply nested - corrupted data?\n");
        return 39;
    }






    b = xmalloc(sizeof *b);
    memcpy(b, a, sizeof *b );



    b->real_fname = a->real_fname? xstrdup(a->real_fname):((void*)0);

    a->filter = ((void*)0);
    a->filter_ov = ((void*)0);
    a->filter_ov_owner = 0;
    a->filter_eof = 0;
    if( a->use == 3 )
 a->use = 2;

    if( a->use == 2 ) {
 b->d.buf = xmalloc( a->d.size );
 b->d.len = 0;
 b->d.start = 0;
    }
    else {
 a->d.buf = xmalloc( a->d.size );
 a->d.len = 0;
 a->d.start = 0;
    }

    a->ntotal = b->ntotal + b->nbytes;
    a->nlimit = a->nbytes = 0;
    a->nofast &= ~1;

    a->chain = b;
    a->opaque = b->opaque;


    a->filter = f;
    a->filter_ov = ov;
    a->filter_ov_owner = rel_ov;

    a->subno = b->subno + 1;

    if( iobuf_debug_mode ) {
        byte desc[32];

 g10_log_debug("iobuf-%d.%d: push `%s'\n", a->no, a->subno,
                  iobuf_desc (a, desc));
 print_chain( a );
    }


    if( a->filter && (rc = a->filter(a->filter_ov, 1, a->chain,
         ((void*)0), &dummy_len)) )
 g10_log_error("IOBUFCTRL_INIT failed: %s\n", g10_errstr(rc) );
    return rc;
}




static int
pop_filter( IOBUF a, int (*f)(void *opaque, int control,
        IOBUF chain, byte *buf, size_t *len), void *ov )
{
    IOBUF b;
    size_t dummy_len=0;
    int rc=0;
    byte desc[32];

    if( a->directfp )
 g10_log_bug0( "iobuf.c" , 1502, __FUNCTION__ );

    if( iobuf_debug_mode )
 g10_log_debug("iobuf-%d.%d: pop `%s'\n", a->no, a->subno,
                  iobuf_desc (a, desc));
    if( !a->filter ) {
 b = a->chain;
 ((void)((b) || (__assert_fail("b", "iobuf.c", 1509, __func__),0)));
 xfree(a->d.buf);
 xfree(a->real_fname);
 memcpy(a,b, sizeof *a);
 xfree(b);
 return 0;
    }
    for(b=a ; b; b = b->chain )
 if( b->filter == f && (!ov || b->filter_ov == ov) )
     break;
    if( !b )
 g10_log_bug("pop_filter(): filter function not found\n");


    if( a->use == 2 && (rc=iobuf_flush(b)) ) {
 g10_log_error("iobuf_flush failed in pop_filter: %s\n", g10_errstr(rc));
 return rc;
    }

    if( b->filter && (rc = b->filter(b->filter_ov, 2, b->chain,
         ((void*)0), &dummy_len)) ) {
 g10_log_error("IOBUFCTRL_FREE failed: %s\n", g10_errstr(rc) );
 return rc;
    }
    if( b->filter_ov && b->filter_ov_owner ) {
 xfree( b->filter_ov );
 b->filter_ov = ((void*)0);
    }



    if( a == b && !b->chain )
 g10_log_bug("can't remove the last filter from the chain\n");
    else if( a == b ) {



 b = a->chain;
 xfree(a->d.buf);
 xfree(a->real_fname);
 memcpy(a,b, sizeof *a);
 xfree(b);
 if( iobuf_debug_mode )
    g10_log_debug("iobuf-%d.%d: popped filter\n", a->no, a->subno );
    }
    else if( !b->chain ) {
 g10_log_bug("Ohh jeee, trying to remove a head filter\n");
    }
    else {
 g10_log_bug("Ohh jeee, trying to remove an intermediate filter\n");
    }

    return rc;
}






static int
underflow(IOBUF a)
{
    size_t len;
    int rc;

    ((void)((a->d.start == a->d.len) || (__assert_fail("a->d.start == a->d.len", "iobuf.c", 1575, __func__),0)));
    if( a->use == 3 )
 return -1;

    if( a->filter_eof ) {
 if( a->chain ) {
            byte desc[32];

     IOBUF b = a->chain;
     if( iobuf_debug_mode )
  g10_log_debug("iobuf-%d.%d: pop `%s' in underflow\n",
                          a->no, a->subno, iobuf_desc (a, desc) );
     xfree(a->d.buf);
     xfree(a->real_fname);
     memcpy(a, b, sizeof *a);
     xfree(b);
     print_chain(a);
 }
 else
             a->filter_eof = 0;
 if( iobuf_debug_mode )
     g10_log_debug("iobuf-%d.%d: underflow: eof (due to filter eof)\n",
          a->no, a->subno );
 return -1;
    }
    if( a->error ) {
 if( iobuf_debug_mode )
     g10_log_debug("iobuf-%d.%d: error\n", a->no, a->subno );
 return -1;
    }

    if( a->directfp ) {
 FILE *fp = a->directfp;

 len = fread( a->d.buf, 1, a->d.size, fp);
 if( len < a->d.size ) {
     if( ferror(fp) )
  a->error = 1;
 }
 a->d.len = len;
 a->d.start = 0;
 return len? a->d.buf[a->d.start++] : -1;
    }


    if( a->filter ) {
 len = a->d.size;
 if( iobuf_debug_mode )
     g10_log_debug("iobuf-%d.%d: underflow: req=%lu\n",
                      a->no, a->subno, (ulong)len );
 rc = a->filter( a->filter_ov, 3, a->chain,
   a->d.buf, &len );
 if( iobuf_debug_mode ) {
     g10_log_debug("iobuf-%d.%d: underflow: got=%lu rc=%d\n",
      a->no, a->subno, (ulong)len, rc );


 }
 if( a->use == 1 && rc == -1 ) {
     size_t dummy_len=0;


     if( (rc = a->filter(a->filter_ov, 2, a->chain,
          ((void*)0), &dummy_len)) )
  g10_log_error("IOBUFCTRL_FREE failed: %s\n", g10_errstr(rc) );
     if( a->filter_ov && a->filter_ov_owner ) {
  xfree( a->filter_ov );
  a->filter_ov = ((void*)0);
     }
     a->filter = ((void*)0);
     a->filter_ov = ((void*)0);
     a->filter_eof = 1;
     if( !len && a->chain ) {
  IOBUF b = a->chain;
  if( iobuf_debug_mode )
      g10_log_debug("iobuf-%d.%d: pop in underflow (!len)\n",
                              a->no, a->subno);
  xfree(a->d.buf);
  xfree(a->real_fname);
  memcpy(a,b, sizeof *a);
  xfree(b);
  print_chain(a);
     }
 }
 else if( rc )
     a->error = 1;

 if( !len ) {
     if( iobuf_debug_mode )
  g10_log_debug("iobuf-%d.%d: underflow: eof\n", a->no, a->subno );
     return -1;
 }
 a->d.len = len;
 a->d.start = 0;
 return a->d.buf[a->d.start++];
    }
    else {
 if( iobuf_debug_mode )
     g10_log_debug("iobuf-%d.%d: underflow: eof (no filter)\n",
          a->no, a->subno );
 return -1;
    }
}


int
iobuf_flush(IOBUF a)
{
    size_t len;
    int rc;

    if( a->directfp )
 return 0;

    if( a->use == 3 ) {
 char *newbuf;
 size_t newsize = a->d.size + 8192;

 if( iobuf_debug_mode )
   g10_log_debug("increasing temp iobuf from %lu to %lu\n",
      (ulong)a->d.size, (ulong)newsize );
 newbuf = xmalloc( newsize );
 memcpy( newbuf, a->d.buf, a->d.len );
 xfree(a->d.buf);
 a->d.buf = newbuf;
 a->d.size = newsize;
 return 0;
    }
    else if( a->use != 2 )
 g10_log_bug("flush on non-output iobuf\n");
    else if( !a->filter )
 g10_log_bug("iobuf_flush: no filter\n");
    len = a->d.len;
    rc = a->filter( a->filter_ov, 4, a->chain, a->d.buf, &len );
    if( !rc && len != a->d.len ) {
 g10_log_info("iobuf_flush did not write all!\n");
 rc = 22;
    }
    else if( rc )
 a->error = 1;
    a->d.len = 0;

    return rc;
}





int
iobuf_readbyte(IOBUF a)
{
    int c;



    if( a->unget.buf ) {
 if( a->unget.start < a->unget.len )
     return a->unget.buf[a->unget.start++];
 xfree(a->unget.buf);
 a->unget.buf = ((void*)0);
 a->nofast &= ~2;
    }

    if( a->nlimit && a->nbytes >= a->nlimit )
 return -1;

    if( a->d.start < a->d.len ) {
 c = a->d.buf[a->d.start++];
    }
    else if( (c=underflow(a)) == -1 )
 return -1;

    a->nbytes++;
    return c;
}


int
iobuf_read(IOBUF a, byte *buf, unsigned buflen )
{
    int c, n;

    if( a->unget.buf || a->nlimit ) {

 for(n=0 ; n < buflen; n++ ) {
     if( (c = iobuf_readbyte(a)) == -1 ) {
  if( !n )
      return -1;
  break;
     }
     else
  if( buf ) *buf = c;
     if( buf ) buf++;
 }
 return n;
    }

    n = 0;
    do {
 if( n < buflen && a->d.start < a->d.len ) {
     unsigned size = a->d.len - a->d.start;
     if( size > buflen - n )
  size = buflen - n;
     if( buf )
  memcpy( buf, a->d.buf + a->d.start, size );
     n += size;
     a->d.start += size;
     if( buf )
  buf += size;
 }
 if( n < buflen ) {
     if( (c=underflow(a)) == -1 ) {
  a->nbytes += n;
  return n? n : -1 ;
     }
     if( buf )
  *buf++ = c;
     n++;
 }
    } while( n < buflen );
    a->nbytes += n;
    return n;
}






int
iobuf_peek(IOBUF a, byte *buf, unsigned buflen )
{
    int n=0;

    if( a->filter_eof )
 return -1;

    if( !(a->d.start < a->d.len) ) {
 if( underflow(a) == -1 )
     return -1;

 ((void)((a->d.start == 1) || (__assert_fail("a->d.start == 1", "iobuf.c", 1817, __func__),0)));
 a->d.start = 0;
    }

    for(n=0 ; n < buflen && (a->d.start+n) < a->d.len ; n++, buf++ )
 *buf = a->d.buf[n];
    return n;
}




int
iobuf_writebyte(IOBUF a, unsigned c)
{

    if( a->directfp )
 g10_log_bug0( "iobuf.c" , 1834, __FUNCTION__ );

    if( a->d.len == a->d.size )
 if( iobuf_flush(a) )
     return -1;

    ((void)((a->d.len < a->d.size) || (__assert_fail("a->d.len < a->d.size", "iobuf.c", 1840, __func__),0)));
    a->d.buf[a->d.len++] = c;
    return 0;
}


int
iobuf_write(IOBUF a, byte *buf, unsigned buflen )
{

    if( a->directfp )
 g10_log_bug0( "iobuf.c" , 1851, __FUNCTION__ );

    do {
 if( buflen && a->d.len < a->d.size ) {
     unsigned size = a->d.size - a->d.len;
     if( size > buflen ) size = buflen;
     memcpy( a->d.buf + a->d.len, buf, size );
     buflen -= size;
     buf += size;
     a->d.len += size;
 }
 if( buflen ) {
     if( iobuf_flush(a) )
  return -1;
 }
    } while( buflen );
    return 0;
}


int
iobuf_writestr(IOBUF a, const char *buf )
{
    for( ; *buf; buf++ )
 if( iobuf_writebyte(a, *buf) )
     return -1;
    return 0;
}






int
iobuf_write_temp( IOBUF a, IOBUF temp )
{
    while( temp->chain )
 pop_filter( temp, temp->filter, ((void*)0) );
    return iobuf_write(a, temp->d.buf, temp->d.len );
}




size_t
iobuf_temp_to_buffer( IOBUF a, byte *buffer, size_t buflen )
{
    size_t n = a->d.len;

    if( n > buflen )
 n = buflen;
    memcpy( buffer, a->d.buf, n );
    return n;
}
# 1914 "iobuf.c"
void
iobuf_flush_temp( IOBUF temp )
{
    while( temp->chain )
 pop_filter( temp, temp->filter, ((void*)0) );
}






void
iobuf_set_limit( IOBUF a, off_t nlimit )
{
    if( nlimit )
 a->nofast |= 1;
    else
 a->nofast &= ~1;
    a->nlimit = nlimit;
    a->ntotal += a->nbytes;
    a->nbytes = 0;
}






off_t
iobuf_get_filelength (IOBUF a, int *overflow )
{
    struct stat st;

    if (overflow)
      *overflow = 0;

    if (a->directfp)
      {
 FILE *fp = a->directfp;
# 1964 "iobuf.c"
        if( !fstat(fileno(fp), &st) )
           return st.st_size;
 g10_log_error("fstat() failed: %s\n", strerror((*__errno_location())) );
 return 0;

    }


    for( ; a; a = a->chain )
 if( !a->chain && a->filter == file_filter ) {
     file_filter_ctx_t *b = a->filter_ov;
     FILEP_OR_FD fp = b->fp;
# 2024 "iobuf.c"
            if( !fstat((fp), &st) )
  return st.st_size;
     g10_log_error("fstat() failed: %s\n", strerror((*__errno_location())) );

     break;
 }

    return 0;
}




int
iobuf_get_fd (IOBUF a)
{
  if (a->directfp)
    return fileno ( (FILE*)a->directfp );

  for ( ; a; a = a->chain )
    if (!a->chain && a->filter == file_filter)
      {
        file_filter_ctx_t *b = a->filter_ov;
        FILEP_OR_FD fp = b->fp;

        return (fp);
      }

  return -1;
}





off_t
iobuf_tell( IOBUF a )
{
    return a->ntotal + a->nbytes;
}
# 2099 "iobuf.c"
int
iobuf_seek( IOBUF a, off_t newpos )
{
    file_filter_ctx_t *b = ((void*)0);

    if( a->directfp ) {
 FILE *fp = a->directfp;
        if( fseeko( fp, newpos, (0) ) ) {
            g10_log_error("can't seek: %s\n", strerror((*__errno_location())) );
     return -1;
 }
 clearerr(fp);
    }
    else {
 for( ; a; a = a->chain ) {
     if( !a->chain && a->filter == file_filter ) {
  b = a->filter_ov;
  break;
     }
 }
 if( !a )
     return -1;
# 2134 "iobuf.c"
       if ( lseek (b->fp, newpos, (0)) == (off_t)-1 ) {
           g10_log_error("can't lseek: %s\n", strerror((*__errno_location())) );
           return -1;
       }


    }
    a->d.len = 0;
    a->d.start = 0;
    a->nbytes = 0;
    a->nlimit = 0;
    a->nofast &= ~1;
    a->ntotal = newpos;
    a->error = 0;

    if( a->chain )
 g10_log_debug("pop_filter called in iobuf_seek - please report\n");
    while( a->chain )
       pop_filter( a, a->filter, ((void*)0) );

    return 0;
}
# 2165 "iobuf.c"
const char *
iobuf_get_real_fname( IOBUF a )
{
    if( a->real_fname )
 return a->real_fname;


    for( ; a; a = a->chain )
 if( !a->chain && a->filter == file_filter ) {
     file_filter_ctx_t *b = a->filter_ov;
     return b->print_only_name? ((void*)0) : b->fname;
 }

    return ((void*)0);
}





const char *
iobuf_get_fname( IOBUF a )
{
    for( ; a; a = a->chain )
 if( !a->chain && a->filter == file_filter ) {
     file_filter_ctx_t *b = a->filter_ov;
     return b->fname;
 }

    return ((void*)0);
}






void
iobuf_set_partial_block_mode( IOBUF a, size_t len )
{
    block_filter_ctx_t *ctx = xmalloc_clear( sizeof *ctx );

    ((void)((a->use == 1 || a->use == 2) || (__assert_fail("a->use == 1 || a->use == 2", "iobuf.c", 2207, __func__),0)));
    ctx->use = a->use;
    if( !len ) {
 if( a->use == 1 )
     g10_log_debug("pop_filter called in set_partial_block_mode"
          " - please report\n");
 pop_filter(a, block_filter, ((void*)0) );
    }
    else {
 ctx->partial = 1;
 ctx->size = 0;
 ctx->first_c = len;
 iobuf_push_filter(a, block_filter, ctx );
    }
}
# 2234 "iobuf.c"
unsigned
iobuf_read_line( IOBUF a, byte **addr_of_buffer,
     unsigned *length_of_buffer, unsigned *max_length )
{
    int c;
    char *buffer = *addr_of_buffer;
    unsigned length = *length_of_buffer;
    unsigned nbytes = 0;
    unsigned maxlen = *max_length;
    char *p;

    if( !buffer ) {
 length = 256;
 buffer = xmalloc( length );
 *addr_of_buffer = buffer;
 *length_of_buffer = length;
    }

    length -= 3;
    p = buffer;
    while( (c=( ((a)->nofast || (a)->d.start >= (a)->d.len )? iobuf_readbyte((a)) : ( (a)->nbytes++, (a)->d.buf[(a)->d.start++] ) )) != -1 ) {
 if( nbytes == length ) {
     if( length > maxlen ) {

  while( c != '\n' && (c=( ((a)->nofast || (a)->d.start >= (a)->d.len )? iobuf_readbyte((a)) : ( (a)->nbytes++, (a)->d.buf[(a)->d.start++] ) )) != -1 )
      ;
  *p++ = '\n';
  nbytes++;
  *max_length = 0;
  break;
     }
     length += 3;
     length += length < 1024? 256 : 1024;
     buffer = xrealloc( buffer, length );
     *addr_of_buffer = buffer;
     *length_of_buffer = length;
     length -= 3;
     p = buffer + nbytes;
 }
 *p++ = c;
 nbytes++;
 if( c == '\n' )
     break;
    }
    *p = 0;

    return nbytes;
}


int
iobuf_translate_file_handle ( int fd, int for_write )
{
# 2304 "iobuf.c"
    return fd;
}

static int
translate_file_handle ( int fd, int for_write )
{
# 2334 "iobuf.c"
    return fd;
}


void
iobuf_skip_rest(IOBUF a, unsigned long n, int partial)
{
    if ( partial ) {
 for (;;) {
     if (a->nofast || a->d.start >= a->d.len) {
  if (iobuf_readbyte (a) == -1) {
      break;
  }
     } else {
  unsigned long count = a->d.len - a->d.start;
  a->nbytes += count;
  a->d.start = a->d.len;
     }
 }
    } else {
 unsigned long remaining = n;
 while (remaining > 0) {
     if (a->nofast || a->d.start >= a->d.len) {
  if (iobuf_readbyte (a) == -1) {
      break;
  }
  --remaining;
     } else {
  unsigned long count = a->d.len - a->d.start;
  if (count > remaining) {
      count = remaining;
  }
  a->nbytes += count;
  a->d.start += count;
  remaining -= count;
     }
 }
    }
}
